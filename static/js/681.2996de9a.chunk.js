"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[681],{2681:function(t,e,n){n.r(e),n.d(e,{EXPERIMENTAL_PUZZLE_BASE_SHAPES:function(){return pt},EXPERIMENTAL_PUZZLE_CUT_TYPES:function(){return dt},ExperimentalPGNotation:function(){return Rt},PuzzleGeometry:function(){return Ft},Quat:function(){return nt},getPG3DNamedPuzzles:function(){return vt},getPuzzleDescriptionString:function(){return mt},getPuzzleGeometryByDesc:function(){return yt},getPuzzleGeometryByName:function(){return bt},parseOptions:function(){return C},parsePuzzleDescription:function(){return gt},schreierSims:function(){return ot}});var r=n(7762),i=n(136),s=n(9388),a=n(9439),o=n(5671),h=n(3144),f=n(1723),l=function(){function t(e,n){(0,o.Z)(this,t),this.facenames=e,this.prefixFree=!0,this.gripnames=[],n&&(this.gripnames=n);for(var r=0;this.prefixFree&&r<e.length;r++)for(var i=0;this.prefixFree&&i<e.length;i++)r!==i&&e[r].startsWith(e[i])&&(this.prefixFree=!1)}return(0,h.Z)(t,[{key:"setGripNames",value:function(t){this.gripnames=t}},{key:"splitByFaceNames",value:function(t){for(var e=[],n=0;n<t.length;){n>0&&n<t.length&&"_"===t[n]&&n++;for(var r=-1,i=0;i<this.facenames.length;i++)t.substr(n).startsWith(this.facenames[i])&&(r<0||this.facenames[i].length>this.facenames[r].length)&&(r=i);if(!(r>=0))throw new Error("Could not split ".concat(t," into face names."));e.push(r),n+=this.facenames[r].length}return e}},{key:"joinByFaceIndices",value:function(t){for(var e="",n=[],r=0;r<t.length;r++)n.push(e),n.push(this.facenames[t[r]]),this.prefixFree||(e="_");return n.join("")}},{key:"spinmatch",value:function(t,e){if(t===e)return!0;try{var n=this.splitByFaceNames(t),r=this.splitByFaceNames(e);if(n.length!==r.length&&n.length<3)return!1;for(var i=0;i<n.length;i++){for(var s=0;s<i;s++)if(n[i]===n[s])return!1;for(var a=!1,o=0;o<r.length;o++)if(n[i]===r[o]){a=!0;break}if(!a)return!1}return!0}catch(h){return!1}}},{key:"spinmatchv",value:function(t,e){return t.endsWith("v")&&e.endsWith("v")?this.spinmatch(t.slice(0,t.length-1),e.slice(0,e.length-1)):this.spinmatch(t,e)}},{key:"unswizzle",value:function(t){(t.endsWith("v")||t.endsWith("w"))&&t[0]<="Z"&&(t=t.slice(0,t.length-1));for(var e=t.toUpperCase(),n=0;n<this.gripnames.length;n++){var r=this.gripnames[n];if(this.spinmatch(e,r))return r}return t}}]),t}(),u=function(){function t(){(0,o.Z)(this,t)}return(0,h.Z)(t,[{key:"notationToInternal",value:function(t){return t}},{key:"notationToExternal",value:function(t){return t}}]),t}(),c=function(){function t(e,n){(0,o.Z)(this,t),this.child=e,this.sw=n}return(0,h.Z)(t,[{key:"notationToInternal",value:function(t){return"T"===t.family&&void 0===t.innerLayer&&void 0===t.outerLayer?new f.A6(new f.mv("FLRv",t.innerLayer,t.outerLayer),t.amount):this.child.notationToInternal(t)}},{key:"notationToExternal",value:function(t){var e=t.family;return e.length>0&&"v"===e[e.length-1]&&(e=e.substring(0,e.length-1)),this.sw.spinmatch(e,"FLUR")?new f.A6(new f.mv("T",t.innerLayer,t.outerLayer),t.amount):this.child.notationToExternal(t)}}]),t}(),v=function(){function t(e,n){(0,o.Z)(this,t),this.internalNames=e,this.externalNames=n}return(0,h.Z)(t,[{key:"convertString",value:function(t,e,n){var r="";(t.endsWith("v")||t.endsWith("v"))&&t<="_"&&(r=t.slice(t.length-1),t=t.slice(0,t.length-1));var i=t.toUpperCase(),s=!1;return t!==i&&(s=!0,t=i),t=n.joinByFaceIndices(e.splitByFaceNames(t)),s&&(t=t.toLowerCase()),t+r}},{key:"convert",value:function(t,e,n){var r=t.family,i=this.convertString(r,e,n);return r===i?t:new f.A6(new f.mv(i,t.innerLayer,t.outerLayer),t.amount)}},{key:"notationToInternal",value:function(t){return this.convert(t,this.externalNames,this.internalNames)}},{key:"notationToExternal",value:function(t){return this.convert(t,this.internalNames,this.externalNames)}}]),t}(),m=function(){function t(e){(0,o.Z)(this,t),this.child=e}return(0,h.Z)(t,[{key:"notationToInternal",value:function(t){if(void 0===t.innerLayer&&void 0===t.outerLayer){if(1===Math.abs(t.amount)){if("R++"===t.family)return new f.A6(new f.mv("L",3,2),-2*t.amount);if("R--"===t.family)return new f.A6(new f.mv("L",3,2),2*t.amount);if("D++"===t.family)return new f.A6(new f.mv("U",3,2),-2*t.amount);if("D--"===t.family)return new f.A6(new f.mv("U",3,2),2*t.amount);if("R_PLUSPLUS_"===t.family)return new f.A6(new f.mv("L",3,2),-2*t.amount);if("D_PLUSPLUS_"===t.family)return new f.A6(new f.mv("U",3,2),-2*t.amount)}if("y"===t.family)return new f.A6("Uv",t.amount);if("x"===t.family&&2===Math.abs(t.amount))return new f.A6("ERv",t.amount/2)}return this.child.notationToInternal(t)}},{key:"notationToExternal",value:function(t){return"ERv"===t.family&&1===Math.abs(t.amount)?new f.A6(new f.mv("x",t.innerLayer,t.outerLayer),2*t.amount):"ILv"===t.family&&1===Math.abs(t.amount)?new f.A6(new f.mv("x",t.innerLayer,t.outerLayer),2*-t.amount):"Uv"===t.family?new f.A6(new f.mv("y",t.innerLayer,t.outerLayer),t.amount):"Dv"===t.family?new f.A6("y",-t.amount):this.child.notationToExternal(t)}}]),t}(),p=function(){function t(e){(0,o.Z)(this,t),this.slices=e}return(0,h.Z)(t,[{key:"notationToInternal",value:function(t){var e=t.family;return t.innerLayer||t.outerLayer||("x"===e?t=new f.A6("Rv",t.amount):"y"===e?t=new f.A6("Uv",t.amount):"z"===e&&(t=new f.A6("Fv",t.amount)),1===(1&this.slices)&&("E"===e?t=new f.A6(new f.mv("D",(this.slices+1)/2),t.amount):"M"===e?t=new f.A6(new f.mv("L",(this.slices+1)/2),t.amount):"S"===e&&(t=new f.A6(new f.mv("F",(this.slices+1)/2),t.amount))),this.slices>2&&("e"===e?t=new f.A6(new f.mv("D",this.slices-1,2),t.amount):"m"===e?t=new f.A6(new f.mv("L",this.slices-1,2),t.amount):"s"===e&&(t=new f.A6(new f.mv("F",this.slices-1,2),t.amount)))),t}},{key:"notationToExternal",value:function(t){var e=t.family;if(!t.innerLayer&&!t.outerLayer){if("Rv"===e)return new f.A6("x",t.amount);if("Uv"===e)return new f.A6("y",t.amount);if("Fv"===e)return new f.A6("z",t.amount);if("Lv"===e)return new f.A6("x",-t.amount);if("Dv"===e)return new f.A6("y",-t.amount);if("Bv"===e)return new f.A6("z",-t.amount)}return t}}]),t}(),d={U:"frl",L:"fld",R:"fdr",B:"dlr",u:"FRL",l:"FLD",r:"FDR",b:"DLR",Uv:"FRLv",Lv:"FLDv",Rv:"FDRv",Bv:"DLRv",D:"D",F:"F",BL:"L",BR:"R"},g={U:"FRL",L:"FLD",R:"FDR",B:"DLR",u:"frl",l:"fld",r:"fdr",b:"dlr",Uv:"FRLv",Lv:"FLDv",Rv:"FDRv",Bv:"DLRv",D:"D",F:"F",BL:"L",BR:"R",d:"d",f:"f",bl:"l",br:"r"},y={U:"FRL",L:"FLD",R:"FDR",B:"DLR"},b=new f.mv("y"),w=new f.mv("Dv"),k=function(){function t(e){(0,o.Z)(this,t),this.child=e,this.wcaHack=!1,this.map=d}return(0,h.Z)(t,[{key:"notationToInternal",value:function(t){if(this.wcaHack&&2===t.innerLayer&&null===t.outerLayer){var e=y[t.family];if(e)return new f.A6(new f.mv(e,t.innerLayer,t.outerLayer),t.amount)}var n=this.map[t.family];return n?new f.A6(new f.mv(n,t.innerLayer,t.outerLayer),t.amount):b.isIdentical(t.quantum)?new f.A6(w,-t.amount):null}},{key:"notationToExternal",value:function(t){if(this.wcaHack&&2===t.innerLayer&&null===t.outerLayer)for(var e=0,n=Object.entries(y);e<n.length;e++){var r=(0,a.Z)(n[e],2),i=r[0],s=r[1];if(this.child.spinmatch(t.family,s))return new f.A6(new f.mv(i,t.innerLayer,t.outerLayer),t.amount)}for(var o=0,h=Object.entries(this.map);o<h.length;o++){var l=(0,a.Z)(h[o],2),u=l[0],c=l[1];if(this.child.spinmatch(t.family,c))return new f.A6(new f.mv(u,t.innerLayer,t.outerLayer),t.amount)}return w.isIdentical(t.quantum)?new f.A6(b,-t.amount):null}}]),t}(),L=function(t){(0,i.Z)(n,t);var e=(0,s.Z)(n);function n(t){var r;return(0,o.Z)(this,n),(r=e.call(this,t)).wcaHack=!0,r.map=g,r}return(0,h.Z)(n)}(k),B={U:"UBL",UL:"ULF",F:"UFR",UR:"URB",B:"DBL",D:"DFR",L:"DLF",R:"DRB",Uv:"UBLv",ULv:"ULFv",Fv:"UFRv",URv:"URBv",Bv:"DBLv",Dv:"DFRv",Lv:"DLFv",Rv:"DRBv"},F=new f.mv("x"),R=new f.mv("Rv"),x=new f.mv("Lv"),M=new f.mv("y"),z=new f.mv("Uv"),D=new f.mv("Dv"),A=new f.mv("z"),E=new f.mv("Fv"),Z=new f.mv("Bv"),U=function(){function t(e){(0,o.Z)(this,t),this.child=e}return(0,h.Z)(t,[{key:"notationToInternal",value:function(t){if(t.innerLayer||t.outerLayer)return null;var e=B[t.family];return e?new f.A6(new f.mv(e,t.outerLayer,t.innerLayer),t.amount):F.isIdentical(t.quantum)?new f.A6(R,t.amount):M.isIdentical(t.quantum)?new f.A6(z,t.amount):A.isIdentical(t.quantum)?new f.A6(E,t.amount):null}},{key:"notationToExternal",value:function(t){for(var e=0,n=Object.entries(B);e<n.length;e++){var r=(0,a.Z)(n[e],2),i=r[0],s=r[1];if(this.child.spinmatchv(t.family,s))return new f.A6(new f.mv(i,t.innerLayer,t.outerLayer),t.amount)}return R.isIdentical(t.quantum)?new f.A6(F,t.amount):x.isIdentical(t.quantum)?new f.A6(F,-t.amount):z.isIdentical(t.quantum)?new f.A6(M,t.amount):D.isIdentical(t.quantum)?new f.A6(M,-t.amount):E.isIdentical(t.quantum)?new f.A6(A,t.amount):Z.isIdentical(t.quantum)?new f.A6(A,-t.amount):null}}]),t}();function C(t){for(var e=0,n={};e<t.length&&"-"===t[e][0];){var r=t[e++];if("--rotations"===r)n.addRotations=!0;else if("--allmoves"===r)n.allMoves=!0;else if("--outerblockmoves"===r)n.outerBlockMoves=!0;else if("--vertexmoves"===r)n.vertexMoves=!0;else if("--nocorners"===r)n.includeCornerOrbits=!1;else if("--noedges"===r)n.includeEdgeOrbits=!1;else if("--noorientation"===r)n.fixedOrientation=!0;else if("--nocenters"===r)n.includeCenterOrbits=!1;else if("--omit"===r)n.excludeOrbits=t[e].split(","),e++;else if("--moves"===r)n.moveList=t[e].split(","),e++;else if("--optimize"===r)n.optimizeOrbits=!0;else if("--scramble"===r)n.scrambleAmount=100;else if("--fixcorner"===r)n.fixedPieceType="v";else if("--fixedge"===r)n.fixedPieceType="e";else if("--fixcenter"===r)n.fixedPieceType="f";else if("--orientcenters"===r)n.orientCenters=!0;else{if("--puzzleorientation"!==r)throw new Error("Bad option: ".concat(r));n.puzzleOrientation=JSON.parse(t[e]),e++}}return{puzzleDescription:gt(t.slice(e).join(" ")),options:n}}var O=(0,h.Z)((function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,o.Z)(this,t),this.verbosity=0,this.allMoves=!1,this.vertexMoves=!1,this.addRotations=!1,this.moveList=null,this.fixedOrientation=!1,this.fixedPieceType=null,this.orientCenters=!1,this.includeCornerOrbits=!0,this.includeCenterOrbits=!0,this.includeEdgeOrbits=!0,this.excludeOrbits=[],this.optimizeOrbits=!1,this.grayCorners=!1,this.grayCenters=!1,this.grayEdges=!1,this.puzzleOrientation=null,this.puzzleOrientations=null,this.scrambleAmount=0,Object.assign(this,e)})),I=[],S=[];function P(t){if(!I[t]){for(var e=Array(t),n=0;n<t;n++)e[n]=0;I[t]=e}return I[t]}function T(t){if(!S[t]){for(var e=Array(t),n=0;n<t;n++)e[n]=n;S[t]=e}return S[t]}function N(t,e){return t/function(t,e){if(t>e){var n=t;t=e,e=n}for(;t>0;){var r=e%t;e=t,t=r}return e}(t,e)*e}var j=function(){function t(e){(0,o.Z)(this,t),this.n=e.length,this.p=e}return(0,h.Z)(t,[{key:"toString",value:function(){return"Perm[".concat(this.p.join(" "),"]")}},{key:"mul",value:function(e){for(var n=Array(this.n),r=0;r<this.n;r++)n[r]=e.p[this.p[r]];return new t(n)}},{key:"rmul",value:function(e){for(var n=Array(this.n),r=0;r<this.n;r++)n[r]=this.p[e.p[r]];return new t(n)}},{key:"inv",value:function(){for(var e=Array(this.n),n=0;n<this.n;n++)e[this.p[n]]=n;return new t(e)}},{key:"compareTo",value:function(t){for(var e=0;e<this.n;e++)if(this.p[e]!==t.p[e])return this.p[e]-t.p[e];return 0}},{key:"toGap",value:function(){for(var t=new Array,e=new Array(this.n),n=0;n<this.p.length;n++)if(!e[n]&&this.p[n]!==n){for(var r=new Array,i=n;!e[i];i=this.p[i])r.push(1+i),e[i]=!0;t.push("(".concat(r.join(","),")"))}return t.join("")}},{key:"order",value:function(){for(var t=1,e=new Array(this.n),n=0;n<this.p.length;n++)if(!e[n]&&this.p[n]!==n){for(var r=0,i=n;!e[i];i=this.p[i])r++,e[i]=!0;t=N(t,r)}return t}}]),t}(),G=function(){function t(e,n){(0,o.Z)(this,t),this.size=e,this.mod=n}return(0,h.Z)(t,[{key:"reassemblySize",value:function(){return function(t){for(var e=BigInt(1);t>1;)e*=BigInt(t),t--;return e}(this.size)*Math.pow(BigInt(this.mod),BigInt(this.size))}}]),t}(),q=0;function K(t,e){var n=f.A6.fromString(e),r=t.notationToExternal(n);return null===r||n===r?e:r.toString()}var _=function(){function t(e,n,r,i,s,a,h){(0,o.Z)(this,t),this.orbitnames=e,this.orbitdefs=n,this.solved=r,this.movenames=i,this.moveops=s,this.isRotation=a,this.forcenames=h}return(0,h.Z)(t,[{key:"transformToKTransformationData",value:function(t){for(var e={},n=0;n<this.orbitnames.length;n++)e[this.orbitnames[n]]=t.orbits[n].toKPuzzle();return e}},{key:"describeSet",value:function(t,e,n){for(var r=this.orbitdefs[t].size,i=new Array(r),s=0;s<r;s++)i[s]=[];for(var a=0;a<this.movenames.length;a++)if(!this.isRotation[a]){var o=this.movenames[a];this.forcenames[a]||"'"===(o=K(n,o))[o.length-1]&&(o=o.substring(0,o.length-1));for(var h=this.moveops[a].orbits[t],f=0;f<r;f++)h.perm[f]===f&&0===h.ori[f]||i[f].push(o)}for(var l=0;l<r;l++)e.push("# ".concat(l+1," ").concat(i[l].join(" ")))}},{key:"toKsolve",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new u,n=[];n.push("Name ".concat(t)),n.push("");for(var r=0;r<this.orbitnames.length;r++)n.push("Set ".concat(this.orbitnames[r]," ").concat(this.orbitdefs[r].size," ").concat(this.orbitdefs[r].mod)),this.describeSet(r,n,e);n.push(""),n.push("Solved");for(var i=0;i<this.orbitnames.length;i++)this.solved.orbits[i].appendDefinition(n,this.orbitnames[i],!1,!1);n.push("End");for(var s=0;s<this.movenames.length;s++){n.push("");var a=this.movenames[s];this.forcenames[s]||(a=K(e,this.movenames[s]));var o=!1;"'"===a[a.length-1]&&(o=!0,a=a.substring(0,a.length-1)),n.push("Move ".concat(a));for(var h=0;h<this.orbitnames.length;h++)o?this.moveops[s].orbits[h].inv().appendDefinition(n,this.orbitnames[h],!0):this.moveops[s].orbits[h].appendDefinition(n,this.orbitnames[h],!0);n.push("End")}return n}},{key:"toKPuzzleDefinition",value:function(t){for(var e={},n={},r=0;r<this.orbitnames.length;r++){e[this.orbitnames[r]]={numPieces:this.orbitdefs[r].size,numOrientations:this.orbitdefs[r].mod};var i=this.solved.orbits[r].toKPuzzle();n[this.orbitnames[r]]={pieces:i.permutation,orientation:i.orientation}}var s={};if(t)for(var a=0;a<this.movenames.length;a++)s[this.movenames[a]]=this.transformToKTransformationData(this.moveops[a]);return{name:"PG3D #".concat(++q),orbits:e,startStateData:n,moves:s}}},{key:"optimize",value:function(){for(var e=[],n=[],r=[],i=[],s=0;s<this.moveops.length;s++)i.push([]);for(var a=0;a<this.orbitdefs.length;a++){for(var o=this.orbitdefs[a].mod,h=this.orbitdefs[a].size,f=new X(h),l=new Array(this.orbitdefs[a].size),u=0;u<h;u++)l[u]=!1;for(var c=0;c<this.moveops.length;c++)if(!this.isRotation[c])for(var v=0;v<h;v++)this.moveops[c].orbits[a].perm[v]===v&&0===this.moveops[c].orbits[a].ori[v]||(l[v]=!0,f.union(v,this.moveops[c].orbits[a].perm[v]));var m=!0;if(o>1){m=!1;for(var p=new X(this.orbitdefs[a].size*o),d=0;d<this.moveops.length;d++)for(var g=0;g<h;g++)if(this.moveops[d].orbits[a].perm[g]!==g||0!==this.moveops[d].orbits[a].ori[g])for(var y=0;y<o;y++)p.union(g*o+y,this.moveops[d].orbits[a].perm[g]*o+(y+this.moveops[d].orbits[a].ori[g])%o);for(var b=0;!m&&b<h;b++)for(var w=1;w<o;w++)p.find(b*o)===p.find(b*o+w)&&(m=!0);for(var k=0;!m&&k<h;k++)for(var L=0;L<k;L++)this.solved.orbits[a].perm[k]===this.solved.orbits[a].perm[L]&&(m=!0)}for(var B=-1,F=!1,R=0;R<this.orbitdefs[a].size;R++)if(l[R]){var x=f.find(R);B<0?B=x:B!==x&&(F=!0)}for(var M=0;M<this.orbitdefs[a].size;M++){if(l[M])if(f.find(M)===M){for(var z=[],D=[],A=0,E=0;E<this.orbitdefs[a].size;E++)f.find(E)===M&&(z[A]=E,D[E]=A,A++);if(F?e.push("".concat(this.orbitnames[a],"_p").concat(M)):e.push(this.orbitnames[a]),m){n.push(new G(A,this.orbitdefs[a].mod)),r.push(this.solved.orbits[a].remapVS(z,A));for(var Z=0;Z<this.moveops.length;Z++)i[Z].push(this.moveops[Z].orbits[a].remap(z,D,A))}else{n.push(new G(A,1)),r.push(this.solved.orbits[a].remapVS(z,A).killOri());for(var U=0;U<this.moveops.length;U++)i[U].push(this.moveops[U].orbits[a].remap(z,D,A).killOri())}}}}return new t(e,n,new V(r),this.movenames,i.map((function(t){return new W(t)})),this.isRotation,this.forcenames)}},{key:"scramble",value:function(t){this.solved=this.solved.mul(this.getScrambleTransformation(t))}},{key:"getScrambleTransformation",value:function(t){t<100&&(t=100);for(var e=[],n=0;n<this.moveops.length;n++)e[n]=this.moveops[n];for(var r=0;r<e.length;r++){var i=Math.floor(Math.random()*e.length),s=e[r];e[r]=e[i],e[i]=s}t<e.length&&(t=e.length);for(var a=0;a<t;a++){var o=Math.floor(Math.random()*e.length),h=Math.floor(Math.random()*e.length),f=Math.floor(Math.random()*this.moveops.length);e[o]=e[o].mul(e[h]).mul(this.moveops[f]),Math.random()<.1&&(e[o]=e[o].mul(this.moveops[f]))}for(var l=e[0],u=1;u<e.length;u++)l=l.mul(e[u]);return l}},{key:"reassemblySize",value:function(){for(var t=BigInt(1),e=0;e<this.orbitdefs.length;e++)t*=this.orbitdefs[e].reassemblySize();return t}}],[{key:"transformToKTransformationData",value:function(t,e){for(var n={},r=0;r<t.length;r++)n[t[r]]=e.orbits[r].toKPuzzle();return n}}]),t}(),H=function(){function t(e,n,r){(0,o.Z)(this,t),this.perm=e,this.ori=n,this.orimod=r}return(0,h.Z)(t,[{key:"mul",value:function(e){var n=this.perm.length,r=new Array(n);if(1===this.orimod){for(var i=0;i<n;i++)r[i]=this.perm[e.perm[i]];return new t(r,this.ori,this.orimod)}for(var s=new Array(n),a=0;a<n;a++)r[a]=this.perm[e.perm[a]],s[a]=(this.ori[e.perm[a]]+e.ori[a])%this.orimod;return new t(r,s,this.orimod)}},{key:"inv",value:function(){for(var e=this.perm.length,n=new Array(e),r=new Array(e),i=0;i<e;i++)n[this.perm[i]]=i,r[this.perm[i]]=(this.orimod-this.ori[i])%this.orimod;return new t(n,r,this.orimod)}},{key:"equal",value:function(t){for(var e=this.perm.length,n=0;n<e;n++)if(this.perm[n]!==t.perm[n]||this.ori[n]!==t.ori[n])return!1;return!0}},{key:"killOri",value:function(){for(var t=this.perm.length,e=0;e<t;e++)this.ori[e]=0;return this.orimod=1,this}},{key:"toPerm",value:function(){var t=this.orimod;if(1===t)return new j(this.perm);for(var e=this.perm.length,n=new Array(e*t),r=0;r<e;r++)for(var i=0;i<t;i++)n[r*t+i]=t*this.perm[r]+(this.ori[r]+i)%t;return new j(n)}},{key:"identicalPieces",value:function(){for(var t=[],e=this.perm.length,n=[],r=0;r<e;r++){var i=this.perm[r];if(void 0===t[i]){var s=[r];t[i]=!0;for(var a=r+1;a<e;a++)this.perm[a]===i&&s.push(a);n.push(s)}}return n}},{key:"order",value:function(){return this.toPerm().order()}},{key:"isIdentity",value:function(){var t=this.perm.length;if(this.perm===T(t)&&this.ori===P(t))return!0;for(var e=0;e<t;e++)if(this.perm[e]!==e||0!==this.ori[e])return!1;return!0}},{key:"zeroOris",value:function(){var t=this.perm.length;if(this.ori===P(t))return!0;for(var e=0;e<t;e++)if(0!==this.ori[e])return!1;return!0}},{key:"remap",value:function(e,n,r){for(var i=new Array(r),s=new Array(r),a=0;a<r;a++)i[a]=n[this.perm[e[a]]],s[a]=this.ori[e[a]];return new t(i,s,this.orimod)}},{key:"remapVS",value:function(e,n){for(var r=new Array(n),i=new Array(n),s=0,a=[],o=0;o<n;o++){var h=this.perm[e[o]];void 0===a[h]&&(a[h]=s++),r[o]=a[h],i[o]=this.ori[e[o]]}return new t(r,i,this.orimod)}},{key:"appendDefinition",value:function(t,e,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if((!r||!this.isIdentity())&&(t.push(e),t.push(this.perm.map((function(t){return t+1})).join(" ")),!this.zeroOris()))if(n){for(var i=new Array(this.ori.length),s=0;s<i.length;s++)i[this.perm[s]]=this.ori[s];t.push(i.join(" "))}else t.push(this.ori.join(" "))}},{key:"toKPuzzle",value:function(){var e=this.perm.length;return this.isIdentity()?(t.kcache[e]||(t.kcache[e]={permutation:T(e),orientation:P(e)}),t.kcache[e]):{permutation:this.perm,orientation:this.ori}}}],[{key:"e",value:function(e,n){return new t(T(e),P(e),n)}}]),t}(),J=H;J.kcache=[];var Q=function(){function t(e){(0,o.Z)(this,t),this.orbits=e}return(0,h.Z)(t,[{key:"internalMul",value:function(t){for(var e=[],n=0;n<this.orbits.length;n++)e.push(this.orbits[n].mul(t.orbits[n]));return e}},{key:"internalInv",value:function(){var t,e=[],n=(0,r.Z)(this.orbits);try{for(n.s();!(t=n.n()).done;){var i=t.value;e.push(i.inv())}}catch(s){n.e(s)}finally{n.f()}return e}},{key:"equal",value:function(t){for(var e=0;e<this.orbits.length;e++)if(!this.orbits[e].equal(t.orbits[e]))return!1;return!0}},{key:"killOri",value:function(){var t,e=(0,r.Z)(this.orbits);try{for(e.s();!(t=e.n()).done;){t.value.killOri()}}catch(n){e.e(n)}finally{e.f()}return this}},{key:"toPerm",value:function(){var t,e=new Array,n=0,i=(0,r.Z)(this.orbits);try{for(i.s();!(t=i.n()).done;){var s=t.value.toPerm();e.push(s),n+=s.n}}catch(u){i.e(u)}finally{i.f()}var a=new Array(n);n=0;for(var o=0,h=e;o<h.length;o++){for(var f=h[o],l=0;l<f.n;l++)a[n+l]=n+f.p[l];n+=f.n}return new j(a)}},{key:"identicalPieces",value:function(){var t,e=[],n=0,i=(0,r.Z)(this.orbits);try{var s=function(){for(var r=t.value,i=r.orimod,s=r.identicalPieces(),a=0;a<s.length;a++)e.push(s[a].map((function(t){return t*i+n})));n+=i*r.perm.length};for(i.s();!(t=i.n()).done;)s()}catch(a){i.e(a)}finally{i.f()}return e}},{key:"order",value:function(){var t,e=1,n=(0,r.Z)(this.orbits);try{for(n.s();!(t=n.n()).done;){e=N(e,t.value.order())}}catch(i){n.e(i)}finally{n.f()}return e}}]),t}(),W=function(t){(0,i.Z)(n,t);var e=(0,s.Z)(n);function n(t){return(0,o.Z)(this,n),e.call(this,t)}return(0,h.Z)(n,[{key:"mul",value:function(t){return new n(this.internalMul(t))}},{key:"mulScalar",value:function(t){if(0===t)return this.e();var e=this;for(t<0&&(e=e.inv(),t=-t);0===(1&t);)e=e.mul(e),t>>=1;if(1===t)return e;for(var n=e,r=this.e();t>0;)1&t&&(r=r.mul(n)),t>1&&(n=n.mul(n)),t>>=1;return r}},{key:"inv",value:function(){return new n(this.internalInv())}},{key:"e",value:function(){return new n(this.orbits.map((function(t){return J.e(t.perm.length,t.orimod)})))}}]),n}(Q),V=function(t){(0,i.Z)(n,t);var e=(0,s.Z)(n);function n(t){return(0,o.Z)(this,n),e.call(this,t)}return(0,h.Z)(n,[{key:"mul",value:function(t){return new n(this.internalMul(t))}}]),n}(Q),X=function(){function t(e){(0,o.Z)(this,t),this.n=e,this.heads=new Array(e);for(var n=0;n<e;n++)this.heads[n]=n}return(0,h.Z)(t,[{key:"find",value:function(t){var e=this.heads[t];return this.heads[e]===e||(e=this.find(this.heads[e]),this.heads[t]=e),e}},{key:"union",value:function(t,e){var n=this.find(t),r=this.find(e);n<r?this.heads[r]=n:n>r&&(this.heads[n]=r)}}]),t}();var Y={"2x2x2":"c f 0","3x3x3":"c f 0.333333333333333","4x4x4":"c f 0.5 f 0","5x5x5":"c f 0.6 f 0.2","6x6x6":"c f 0.666666666666667 f 0.333333333333333 f 0","7x7x7":"c f 0.714285714285714 f 0.428571428571429 f 0.142857142857143","8x8x8":"c f 0.75 f 0.5 f 0.25 f 0","9x9x9":"c f 0.777777777777778 f 0.555555555555556 f 0.333333333333333 f 0.111111111111111","10x10x10":"c f 0.8 f 0.6 f 0.4 f 0.2 f 0","11x11x11":"c f 0.818181818181818 f 0.636363636363636 f 0.454545454545455 f 0.272727272727273 f 0.0909090909090909","12x12x12":"c f 0.833333333333333 f 0.666666666666667 f 0.5 f 0.333333333333333 f 0.166666666666667 f 0","13x13x13":"c f 0.846153846153846 f 0.692307692307692 f 0.538461538461538 f 0.384615384615385 f 0.230769230769231 f 0.0769230769230769","20x20x20":"c f 0 f .1 f .2 f .3 f .4 f .5 f .6 f .7 f .8 f .9","30x30x30":"c f 0 f .066667 f .133333 f .2 f .266667 f .333333 f .4 f .466667 f .533333 f .6 f .666667 f .733333 f .8 f .866667 f .933333","40x40x40":"c f 0 f .05 f .1 f .15 f .2 f .25 f .3 f .35 f .4 f .45 f .5 f .55 f .6 f .65 f .7 f .75 f .8 f .85 f .9 f .95",skewb:"c v 0","master skewb":"c v 0.275","professor skewb":"c v 0 v 0.38","compy cube":"c v 0.915641442663986",helicopter:"c e 0.707106781186547","curvy copter":"c e 0.83",dino:"c v 0.577350269189626","little chop":"c e 0",pyramorphix:"t e 0",mastermorphix:"t e 0.346184634065199",pyraminx:"t v 0.333333333333333 v 1.66666666666667",tetraminx:"t v 0.333333333333333","master pyraminx":"t v 0 v 1 v 2","master tetraminx":"t v 0 v 1","professor pyraminx":"t v -0.2 v 0.6 v 1.4 v 2.2","professor tetraminx":"t v -0.2 v 0.6 v 1.4","Jing pyraminx":"t f 0","master pyramorphix":"t e 0.866025403784437",megaminx:"d f 0.7",gigaminx:"d f 0.64 f 0.82",teraminx:"d f 0.64 f 0.76 f 0.88",petaminx:"d f 0.64 f 0.73 f 0.82 f 0.91",examinx:"d f 0.64 f 0.712 f 0.784 f 0.856 f 0.928",zetaminx:"d f 0.64 f 0.7 f 0.76 f 0.82 f 0.88 f 0.94",yottaminx:"d f 0.64 f 0.6914 f 0.7429 f 0.7943 f 0.8457 f 0.8971 f 0.9486",pentultimate:"d f 0","master pentultimate":"d f 0.1","elite pentultimate":"d f 0 f 0.145905",starminx:"d v 0.937962370425399","starminx 2":"d f 0.23606797749979","pyraminx crystal":"d f 0.447213595499989",chopasaurus:"d v 0","big chop":"d e 0","skewb diamond":"o f 0",FTO:"o f 0.333333333333333","master FTO":"o f 0.5 f 0","Christopher's jewel":"o v 0.577350269189626",octastar:"o e 0","Trajber's octahedron":"o v 0.433012701892219","radio chop":"i f 0",icosamate:"i v 0","icosahedron 2":"i v 0.18759247376021","icosahedron 3":"i v 0.18759247376021 e 0","icosahedron static faces":"i v 0.84","icosahedron moving faces":"i v 0.73","Eitan's star":"i f 0.61803398874989","2x2x2 + dino":"c f 0 v 0.577350269189626","2x2x2 + little chop":"c f 0 e 0","dino + little chop":"c v 0.577350269189626 e 0","2x2x2 + dino + little chop":"c f 0 v 0.577350269189626 e 0","megaminx + chopasaurus":"d f 0.61803398875 v 0","starminx combo":"d f 0.23606797749979 v 0.937962370425399"},$=1e-9;function tt(t){for(var e=new nt(0,0,0,0),n=0;n<t.length;n++)e=e.sum(t[n]);return e.smul(1/t.length)}function et(t,e,n,r){var i=r[t].intersect3(r[e],r[n]);if(!i)return i;for(var s=0;s<r.length;s++)if(s!==t&&s!==e&&s!==n){var a=r[s].b*i.b+r[s].c*i.c+r[s].d*i.d;if(r[s].a>0&&a>r[s].a||r[s].a<0&&a<r[s].a)return!1}return i}var nt=function(){function t(e,n,r,i){(0,o.Z)(this,t),this.a=e,this.b=n,this.c=r,this.d=i}return(0,h.Z)(t,[{key:"mul",value:function(e){return new t(this.a*e.a-this.b*e.b-this.c*e.c-this.d*e.d,this.a*e.b+this.b*e.a+this.c*e.d-this.d*e.c,this.a*e.c-this.b*e.d+this.c*e.a+this.d*e.b,this.a*e.d+this.b*e.c-this.c*e.b+this.d*e.a)}},{key:"toString",value:function(){return"Q[".concat(this.a,",").concat(this.b,",").concat(this.c,",").concat(this.d,"]")}},{key:"dist",value:function(t){return Math.hypot(this.a-t.a,this.b-t.b,this.c-t.c,this.d-t.d)}},{key:"len",value:function(){return Math.hypot(this.a,this.b,this.c,this.d)}},{key:"cross",value:function(e){return new t(0,this.c*e.d-this.d*e.c,this.d*e.b-this.b*e.d,this.b*e.c-this.c*e.b)}},{key:"dot",value:function(t){return this.b*t.b+this.c*t.c+this.d*t.d}},{key:"normalize",value:function(){var e=Math.sqrt(this.dot(this));return new t(this.a/e,this.b/e,this.c/e,this.d/e)}},{key:"makenormal",value:function(){return new t(0,this.b,this.c,this.d).normalize()}},{key:"normalizeplane",value:function(){var e=Math.hypot(this.b,this.c,this.d);return new t(this.a/e,this.b/e,this.c/e,this.d/e)}},{key:"smul",value:function(e){return new t(this.a*e,this.b*e,this.c*e,this.d*e)}},{key:"sum",value:function(e){return new t(this.a+e.a,this.b+e.b,this.c+e.c,this.d+e.d)}},{key:"sub",value:function(e){return new t(this.a-e.a,this.b-e.b,this.c-e.c,this.d-e.d)}},{key:"angle",value:function(){return 2*Math.acos(this.a)}},{key:"invrot",value:function(){return new t(this.a,-this.b,-this.c,-this.d)}},{key:"det3x3",value:function(t,e,n,r,i,s,a,o,h){return t*(i*h-s*o)+e*(s*a-r*h)+n*(r*o-i*a)}},{key:"rotateplane",value:function(e){var n=e.mul(new t(0,this.b,this.c,this.d)).mul(e.invrot());return n.a=this.a,n}},{key:"orthogonal",value:function(){var e=Math.abs(this.b),n=Math.abs(this.c),r=Math.abs(this.d);return e<n&&e<r?this.cross(new t(0,1,0,0)).normalize():n<e&&n<r?this.cross(new t(0,0,1,0)).normalize():this.cross(new t(0,0,0,1)).normalize()}},{key:"pointrotation",value:function(e){var n=this.normalize();if(e=e.normalize(),n.sub(e).len()<$)return new t(1,0,0,0);var r=n.sum(e);r=r.len()<$?r.orthogonal():r.normalize();var i=n.cross(r);return i.a=n.dot(r),i}},{key:"unproject",value:function(t){return this.sum(t.smul(-this.dot(t)/(this.len()*t.len())))}},{key:"rotatepoint",value:function(t){return t.mul(this).mul(t.invrot())}},{key:"rotateface",value:function(t){var e=this;return t.map((function(t){return t.rotatepoint(e)}))}},{key:"intersect3",value:function(e,n){var r=this.det3x3(this.b,this.c,this.d,e.b,e.c,e.d,n.b,n.c,n.d);return!(Math.abs(r)<$)&&new t(0,this.det3x3(this.a,this.c,this.d,e.a,e.c,e.d,n.a,n.c,n.d)/r,this.det3x3(this.b,this.a,this.d,e.b,e.a,e.d,n.b,n.a,n.d)/r,this.det3x3(this.b,this.c,this.a,e.b,e.c,e.a,n.b,n.c,n.a)/r)}},{key:"side",value:function(t){return t>$?1:t<-$?-1:0}},{key:"cutface",value:function(t){for(var e=this,n=this.a,r=0,i=null,s=0;s<t.length;s++)r|=1<<this.side(t[s].dot(this)-n)+1;if(5===(5&r)){i=[];for(var a=t.map((function(t){return e.side(t.dot(e)-n)})),o=-1;o<=1;o+=2){for(var h=[],f=0;f<t.length;f++){a[f]!==o&&0!==a[f]||h.push(t[f]);var l=(f+1)%t.length;if(a[f]+a[l]===0&&0!==a[f]){var u=t[f].dot(this)-n,c=u/(u-(t[l].dot(this)-n)),v=t[f].smul(1-c).sum(t[l].smul(c));h.push(v)}}i.push(h)}}return i}},{key:"cutfaces",value:function(t){for(var e=[],n=0;n<t.length;n++){var r=t[n],i=this.cutface(r);i?(e.push(i[0]),e.push(i[1])):e.push(r)}return e}},{key:"faceside",value:function(t){for(var e=this.a,n=0;n<t.length;n++){var r=this.side(t[n].dot(this)-e);if(0!==r)return r}throw new Error("Could not determine side of plane in faceside")}},{key:"sameplane",value:function(t){var e=this.normalize(),n=t.normalize();return e.dist(n)<$||e.dist(n.smul(-1))<$}},{key:"makecut",value:function(e){return new t(e,this.b,this.c,this.d)}}]),t}(),rt=1e-9;function it(t,e){for(var n=[],r=[],i=0;i<e.length;i++){for(var s=t.rotateplane(e[i]),a=!1,o=0;o<n.length;o++)if(s.dist(n[o])<rt){a=!0;break}a||(n.push(s),r.push(e[i]))}return r}function st(t){for(var e=[],n=1;n<t.length;n++)for(var r=n+1;r<t.length;r++){var i=et(0,n,r,t);if(i){for(var s=!1,a=0;a<e.length;a++)if(i.dist(e[a])<rt){s=!0;break}s||e.push(i)}}for(;;){for(var o=!1,h=0;h<e.length;h++){var f=(h+1)%e.length;if(t[0].dot(e[h].cross(e[f]))<0){var l=e[h];e[h]=e[f],e[f]=l,o=!0}}if(!o)break}return e}var at=function(){function t(){(0,o.Z)(this,t),this.mult=[]}return(0,h.Z)(t,[{key:"multiply",value:function(t){for(var e=2;e*e<=t;e++)for(;t%e===0;)void 0!==this.mult[e]?this.mult[e]++:this.mult[e]=1,t/=e;t>1&&(void 0!==this.mult[t]?this.mult[t]++:this.mult[t]=1)}},{key:"toString",value:function(){for(var t="",e=0;e<this.mult.length;e++)void 0!==this.mult[e]&&(""!==t&&(t+="*"),t+=e,this.mult[e]>1&&(t+="^".concat(this.mult[e])));return t}}]),t}();function ot(t,e){var n=t[0].p.length,r=function(t){return new j(T(t))}(n),i=[],s=[],a=[],o=[],h=[];function f(t,e,n){o[t].push(e),h[t].push(n);for(var r=0;r<i[t].length;r++)i[t][r]&&l(t,i[t][r].mul(e),n+a[t][r])}function l(t,e,n){var r=e.p[t];if(i[t][r]){var u=e.mul(s[t][r]);(function(t){for(var e=t.p.length-1;e>=0;e--){var n=t.p[e];if(n!==e){if(!i[e][n])return!1;t=t.mul(s[e][n])}}return!0})(u)||f(t-1,u,n+a[t][r])}else{i[t][r]=e,s[t][r]=e.inv(),a[t][r]=n;for(var c=0;c<o[t].length;c++)l(t,e.mul(o[t][c]),n+h[t][c])}}return function(){i=[],s=[],o=[],a=[],h=[];for(var l=0;l<n;l++)i.push([]),s.push([]),a.push([]),o.push([]),h.push([]),i[l][l]=r,s[l][l]=r,a[l][l]=0;for(var u=0,c=BigInt(1),v=0;v<t.length;v++){f(n-1,t[v],1),c=BigInt(1);for(var m=0,p=0,d=[],g=new at,y=0;y<n;y++){for(var b=0,w=0,k=0;k<n;k++)i[y][k]&&(b++,w+=a[y][k],y!==k&&u++);m+=o[y].length,c*=BigInt(b),b>1&&g.multiply(b);var L=w/b;d.push(L),p+=L}e("".concat(v,": sz ").concat(c," T ").concat(m," sol ").concat(p," none ").concat(u," mults ").concat(g.toString()))}return c}()}var ht=function(){function t(e){(0,o.Z)(this,t),this.coords=new Array(3*e.length);for(var n=0;n<e.length;n++)this.coords[3*n]=e[n].b,this.coords[3*n+1]=e[n].c,this.coords[3*n+2]=e[n].d;this.length=e.length}return(0,h.Z)(t,[{key:"get",value:function(t){return new nt(0,this.coords[3*t],this.coords[3*t+1],this.coords[3*t+2])}},{key:"centermass",value:function(){for(var t=0,e=0,n=0,r=0;r<this.length;r++)t+=this.coords[3*r],e+=this.coords[3*r+1],n+=this.coords[3*r+2];return new nt(0,t/this.length,e/this.length,n/this.length)}},{key:"rotate",value:function(e){for(var n=[],r=0;r<this.length;r++)n.push(this.get(r).rotatepoint(e));return new t(n)}},{key:"rotateforward",value:function(){for(var e=[],n=1;n<this.length;n++)e.push(this.get(n));return e.push(this.get(0)),new t(e)}}]),t}(),ft=function(){function t(e,n,r){(0,o.Z)(this,t),this.face=e,this.left=n,this.right=r}return(0,h.Z)(t,[{key:"split",value:function(e){var n,r,i=e.cutface(this.face);null!==i&&(void 0===this.left?(this.left=new t(i[0]),this.right=new t(i[1])):(this.left=null===(n=this.left)||void 0===n?void 0:n.split(e),this.right=null===(r=this.right)||void 0===r?void 0:r.split(e)));return this}},{key:"collect",value:function(t,e){if(void 0===this.left)t.push(new ht(this.face));else if(e){var n,r;null===(n=this.left)||void 0===n||n.collect(t,!1),null===(r=this.right)||void 0===r||r.collect(t,!0)}else{var i,s;null===(i=this.right)||void 0===i||i.collect(t,!1),null===(s=this.left)||void 0===s||s.collect(t,!0)}return t}}]),t}();var lt=1e-9;var ut={4:{v:["DFR","DLF","DRL","FLR"],e:["FR","LF","DF","DL","RD","RL"],c:["DF","FD","RL","LR"]},6:{v:["URF","UBR","ULB","UFL","DFR","DRB","DBL","DLF"],e:["UF","UR","UB","UL","DF","DR","DB","DL","FR","FL","BR","BL"],c:["UB","LU","FU","RU","BU","DF"]},8:{v:["UBBBRR","URFL","ULBLBB","DBRBBBL","DBLLF","DFRBR"],e:["UL","UBB","UR","BRD","BLD","FD","BRR","FR","FL","BLL","BLBB","BRBB"],c:["BBU","LU","RU","BRD","FD","BLD","DF","UBB"]},12:{v:["URF","UFL","ULBL","UBLBR","UBRR","DEBF","DBFI","DIA","DAC","DCE","LAI","ALF","FCA","CFR","REC","ERBR","BRBFE","BFBRBL","BLIBF","IBLL"],e:["UF","UR","UBR","UBL","UL","ER","EBR","EBF","ED","EC","IBF","IBL","IL","IA","ID","AC","CF","FA","BFBR","BRBL","BLBF","CD","AD","AL","FL","FR","CR","BFD","BRR","BLL"],c:["UF","FU","DBF","BFD","AD","CD","BRU","BLU","LA","RA","EBR","IBL"]},20:{v:["FLPQU","FUGER","FRCAL","HCREI","ISBDH","JSIEG","BSJMK","MQPOK","ONDBK","NOPLA","UQMJG","DNACH"],e:["FU","FL","FR","EG","ER","EI","SJ","SI","SB","KM","KB","KO","PQ","PO","PL","UG","JG","MQ","UQ","HC","HD","ND","NA","JM","CA","AL","CR","HI","DB","NO"],c:["FU","UF","GE","EG","JS","SJ","MK","KM","QP","PQ","LA","AL","RC","CR","IH","HI","BD","DB","ON","NO"]}};function ct(t,e){for(var n=0;n<t.length;n++)if(t[n][0].dist(e)<lt)return n;throw new Error("Element not found")}function vt(){return Y}function mt(t){return Y[t]}var pt=["c","t","o","d","i"],dt=["f","v","e"];function gt(t){var e=t.split(/ /).filter(Boolean);if(e.length%2===0)return null;var n=e[0];if("o"!==n&&"c"!==n&&"i"!==n&&"d"!==n&&"t"!==n)return null;for(var r=[],i=1;i<e.length;i+=2){if("f"!==e[i]&&"v"!==e[i]&&"e"!==e[i])return null;r.push({cutType:e[i],distance:parseFloat(e[i+1])})}return{shape:n,cuts:r}}function yt(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=gt(t);if(null===n)throw new Error("Could not parse the puzzle description");var r=new Ft(n,Object.assign({},{allMoves:!0},e));return r.allstickers(),r.genperms(),r}function bt(t,e){return yt(Y[t],e)}function wt(t,e,n){var r=!1;n-e[1]<e[0]&&(t=[t[2],t[3],t[0],t[1]],e=[n-e[1],n-e[0]],r=!0);var i=t[0],s="";if(0===e[0]&&e[1]===n)i="".concat(i,"v");else if(e[0]===e[1])e[1]>0&&(s=String(e[1]+1));else{if(0!==e[0])throw new Error("We only support slice and outer block moves right now. ".concat(e));i=i.toLowerCase(),e[1]>1&&(s=String(e[1]+1))}return[s+i,r]}function kt(t,e){for(var n=[],i=0;i<t.length;){i>0&&i<t.length&&"_"===t[i]&&i++;var s,a="",o=(0,r.Z)(e);try{for(o.s();!(s=o.n()).done;){var h=s.value;t.substr(i).startsWith(h[1])&&h[1].length>a.length&&(a=h[1])}}catch(f){o.e(f)}finally{o.f()}if(""===a)throw new Error("Could not split ".concat(t," into face names."));n.push(a),i+=a.length}return n}function Lt(t,e){return[t.b/e,-t.c/e,t.d/e]}function Bt(t,e){for(var n=[],r=t.length,i=0;i<r;i++){var s=Lt(t.get(r-i-1),e);n[3*i]=s[0],n[3*i+1]=s[1],n[3*i+2]=s[2]}return n}var Ft=function(){function t(e,n){(0,o.Z)(this,t),this.puzzleDescription=e,this.cmovesbyslice=[],this.duplicatedFaces=[],this.duplicatedCubies=[],this.fixedCubie=-1,this.net=[],this.colors=[],this.notationMapper=new u,this.addNotationMapper="",this.setReidOrder=!1;this.options=new O(n),this.options.verbosity>0&&console.log(this.header("# ")),this.create(e)}return(0,h.Z)(t,[{key:"create",value:function(t){var e=t.shape,n=t.cuts;this.moveplanes=[],this.moveplanes2=[],this.faces=[],this.cubies=[];var i=null;switch(e){case"c":i=function(){var t=Math.sqrt(.5);return[new nt(t,t,0,0),new nt(t,0,t,0)]}();break;case"o":i=function(){var t=Math.sqrt(.5);return[new nt(.5,.5,.5,.5),new nt(t,0,0,t)]}();break;case"i":i=function(){var t=1/6+Math.sqrt(5)/6,e=2/3+Math.sqrt(5)/3,n=Math.sqrt(t*t+e*e);t/=n,e/=n;var r=2*Math.PI/6;return[new nt(Math.cos(r),t*Math.sin(r),e*Math.sin(r),0),new nt(Math.cos(r),-t*Math.sin(r),e*Math.sin(r),0)]}();break;case"t":i=[new nt(.5,.5,.5,.5),new nt(.5,.5,.5,-.5)];break;case"d":i=function(){var t=2*Math.PI/10,e=.5+.3*Math.sqrt(5),n=.5+.1*Math.sqrt(5),r=Math.sqrt(e*e+n*n);return e/=r,n/=r,[new nt(Math.cos(t),e*Math.sin(t),n*Math.sin(t),0),new nt(.5,.5,.5,.5)]}();break;default:throw new Error("Bad shape argument: ".concat(e))}this.rotations=function(t){for(var e=[new nt(1,0,0,0)],n=0;n<e.length;n++)for(var r=0;r<t.length;r++){for(var i=t[r].mul(e[n]),s=i.smul(-1),a=!1,o=0;o<e.length;o++)if(i.dist(e[o])<rt||s.dist(e[o])<rt){a=!0;break}a||e.push(i)}return e}(i),this.options.verbosity&&console.log("# Rotations: ".concat(this.rotations.length));var s=i[0];this.baseplanerot=it(s,this.rotations);var a=this.baseplanerot.map((function(t){return s.rotateplane(t)}));this.baseplanes=a,this.baseFaceCount=a.length;var o={4:[["F","D","L","R"]],6:[["F","D","L","U","R"],["R","F","","B",""]],8:[["F","D","L","R"],["D","F","BR",""],["BR","D","","BB"],["BB","BR","U","BL"]],12:[["U","F","","","",""],["F","U","R","C","A","L"],["R","F","","","E",""],["E","R","","BF","",""],["BF","E","BR","BL","I","D"]],20:[["R","C","F","E"],["F","R","L","U"],["L","F","A",""],["E","R","G","I"],["I","E","S","H"],["S","I","J","B"],["B","S","K","D"],["K","B","M","O"],["O","K","P","N"],["P","O","Q",""]]}[a.length];this.net=o,this.colors={4:{F:"#00ff00",D:"#ffff00",L:"#ff0000",R:"#0000ff"},6:{U:"#ffffff",F:"#00ff00",R:"#ff0000",D:"#ffff00",B:"#0000ff",L:"#ff8000"},8:{U:"#ffffff",F:"#ff0000",R:"#00bb00",D:"#ffff00",BB:"#1122ff",L:"#9524c5",BL:"#ff8800",BR:"#aaaaaa"},12:{U:"#ffffff",F:"#006633",R:"#ff0000",C:"#ffffd0",A:"#3399ff",L:"#660099",E:"#ff66cc",BF:"#99ff00",BR:"#0000ff",BL:"#ffff00",I:"#ff6633",D:"#999999"},20:{R:"#db69f0",C:"#178fde",F:"#23238b",E:"#9cc726",L:"#2c212d",U:"#177fa7",A:"#e0de7f",G:"#2b57c0",I:"#41126b",S:"#4b8c28",H:"#7c098d",J:"#7fe7b4",B:"#85fb74",K:"#3f4bc3",D:"#0ff555",M:"#f1c2c8",O:"#58d340",P:"#c514f2",N:"#14494e",Q:"#8b1be1"}}[a.length],this.options.verbosity>0&&console.log("# Base planes: ".concat(a.length));var h=st(a),f=new nt(0,0,0,0);this.options.verbosity>0&&console.log("# Face vertices: ".concat(h.length));var u=a[0].makenormal(),c=h[0].sum(h[1]).makenormal(),m=h[0].makenormal(),p=new nt(1,u.b,u.c,u.d);this.options.verbosity>0&&console.log("# Boundary is ".concat(p));var d=st(it(p,this.rotations).map((function(t){return p.rotateplane(t)})));this.edgedistance=d[0].sum(d[1]).smul(.5).dist(f),this.vertexdistance=d[0].dist(f);var g,y=[],b=[],w=!1,k=!1,L=!1,B=(0,r.Z)(n);try{for(B.s();!(g=B.n()).done;){var F=g.value,R=null,x=0;switch(F.cutType){case"f":R=u,x=1,w=!0;break;case"v":R=m,x=this.vertexdistance,L=!0;break;case"e":R=c,x=this.edgedistance,k=!0;break;default:throw new Error("Bad cut argument: ".concat(F.cutType))}y.push(R.makecut(F.distance)),b.push(F.distance<x)}}catch(cn){B.e(cn)}finally{B.f()}this.options.addRotations&&(w||y.push(u.makecut(10)),L||y.push(m.makecut(10)),k||y.push(c.makecut(10))),this.basefaces=[];var M,z=(0,r.Z)(this.baseplanerot);try{for(z.s();!(M=z.n()).done;){var D=M.value.rotateface(d);this.basefaces.push(new ht(D))}}catch(cn){z.e(cn)}finally{z.f()}var A=[],E=[],Z=[],U=[],C=d.length;function O(t,e,n){var i,s=(0,r.Z)(t);try{for(s.s();!(i=s.n()).done;){var a=i.value;if(a[0].dist(e)<lt)return void a.push(n)}}catch(cn){s.e(cn)}finally{s.f()}t.push([e,n])}for(var I=0;I<this.baseplanerot.length;I++)for(var S=this.baseplanerot[I].rotateface(d),P=0;P<S.length;P++){var T=(P+1)%S.length;O(U,S[P].sum(S[T]).smul(.5),I)}for(var N=[],j=0;j<this.baseplanerot.length;j++){for(var G=this.baseplanerot[j].rotateface(d),q=[],K=0;K<G.length;K++){var _=(K+1)%G.length,H=U[ct(U,G[K].sum(G[_]).smul(.5))];if(j===H[1])q.push(H[2]);else{if(j!==H[2])throw new Error("Could not find edge");q.push(H[1])}}N.push(q)}var J={},Q=[];Q.push(o[0][0]),J[o[0][0]]=0,Q[N[0][0]]=o[0][1],J[o[0][1]]=N[0][0];var W,V=(0,r.Z)(o);try{for(V.s();!(W=V.n()).done;){var X=W.value,Y=J[X[0]];if(void 0===Y)throw new Error("Bad edge description; first edge not connected");for(var $=-1,et=0;et<N[Y].length;et++){var at=Q[N[Y][et]];if(void 0!==at&&at===X[1]){$=et;break}}if($<0)throw new Error("First element of a net not known");for(var ot=2;ot<X.length;ot++)if(""!==X[ot]){var vt=N[Y][(ot+$-1)%C],mt=Q[vt];if(void 0!==mt&&mt!==X[ot])throw new Error("Face mismatch in net");Q[vt]=X[ot],J[X[ot]]=vt}}}catch(cn){V.e(cn)}finally{V.f()}for(var pt=0;pt<this.baseplanerot.length;pt++){var dt=this.baseplanerot[pt].rotateface(d),gt=p.rotateplane(this.baseplanerot[pt]),yt=Q[pt];A.push([dt,yt]),E.push([gt,yt])}for(var bt=0;bt<this.baseplanerot.length;bt++)for(var wt=this.baseplanerot[bt].rotateface(d),kt=Q[bt],Lt=0;Lt<wt.length;Lt++){var Bt=(Lt+1)%wt.length,Ft=wt[Lt].sum(wt[Bt]).smul(.5),Rt=(Lt+2)%wt.length,xt=wt[Bt].sum(wt[Rt]).smul(.5),Mt=ct(U,Ft),zt=ct(U,xt);O(Z,wt[Bt],[kt,zt,Mt])}this.swizzler=new l(A.map((function(t){return t[1]})));for(var Dt=this.swizzler.prefixFree?"":"_",At=ut[this.baseFaceCount],Et=[],Zt=0;Zt<this.baseFaceCount;Zt++)Et[1<<Zt]=Zt;var Ut,Ct=At.v,Ot=(0,r.Z)(Ct);try{for(Ot.s();!(Ut=Ot.n()).done;){var It,St=Ut.value,Pt=this.swizzler.splitByFaceNames(St),Tt=0,Nt=(0,r.Z)(Pt);try{for(Nt.s();!(It=Nt.n()).done;){Tt|=1<<It.value}}catch(cn){Nt.e(cn)}finally{Nt.f()}Et[Tt]=Pt[0]}}catch(cn){Ot.e(cn)}finally{Ot.f()}var jt,Gt=At.e,qt=(0,r.Z)(Gt);try{for(qt.s();!(jt=qt.n()).done;){var Kt,_t=jt.value,Ht=this.swizzler.splitByFaceNames(_t),Jt=0,Qt=(0,r.Z)(Ht);try{for(Qt.s();!(Kt=Qt.n()).done;){Jt|=1<<Kt.value}}catch(cn){Qt.e(cn)}finally{Qt.f()}Et[Jt]=Ht[0]}}catch(cn){qt.e(cn)}finally{qt.f()}var Wt,Vt=At.c,Xt=(0,r.Z)(Vt);try{for(Xt.s();!(Wt=Xt.n()).done;){var Yt=Wt.value,$t=this.swizzler.splitByFaceNames(Yt);Et[1<<$t[0]|1<<this.baseFaceCount]=$t[1]}}catch(cn){Xt.e(cn)}finally{Xt.f()}for(var te=0;te<U.length;te++){if(3!==U[te].length)throw new Error("Bad length in edge names ".concat(U[te]));var ee=U[te][1],ne=U[te][2],re=Q[ee],ie=Q[ne];re=Et[1<<ee|1<<ne]===ee?re+Dt+ie:ie+Dt+re,U[te]=[U[te][0],re]}for(var se=0;se<Z.length;se++){var ae=0;if(Z[se].length<4)throw new Error("Bad length in vertex names");for(var oe=1;oe<Z[se].length;oe++)ae|=1<<J[Z[se][oe][0]];for(var he=Et[ae],fe=-1,le=1;le<Z[se].length;le++)he===J[Z[se][le][0]]&&(fe=le);if(fe<0)throw new Error("Internal error; couldn't find face name when fixing corners");for(var ue="",ce=1;ce<Z[se].length;ce++){ue=1===ce?Z[se][fe][0]:ue+Dt+Z[se][fe][0];for(var ve=1;ve<Z[se].length;ve++)if(Z[se][fe][1]===Z[se][ve][2]){fe=ve;break}}Z[se]=[Z[se][0],ue]}this.markedface=Et,this.options.verbosity>1&&(console.log("# Face names: ".concat(A.map((function(t){return t[1]})).join(" "))),console.log("# Edge names: ".concat(U.map((function(t){return t[1]})).join(" "))),console.log("# Vertex names: ".concat(Z.map((function(t){return t[1]})).join(" "))));for(var me=[],pe=0,de=E;pe<de.length;pe++){var ge=de[pe];me.push([ge[0].makenormal(),ge[1],"f"])}for(var ye=0,be=U;ye<be.length;ye++){var we=be[ye];me.push([we[0].makenormal(),we[1],"e"])}for(var ke=0,Le=Z;ke<Le.length;ke++){var Be=Le[ke];me.push([Be[0].makenormal(),Be[1],"v"])}this.facenames=A,this.faceplanes=E,this.edgenames=U,this.vertexnames=Z,this.geonormals=me;var Fe=me.map((function(t){return t[1]}));this.swizzler.setGripNames(Fe),this.options.verbosity>0&&console.log("# Distances: face ".concat(1," edge ",this.edgedistance," vertex ").concat(this.vertexdistance));for(var Re=0;Re<y.length;Re++){var xe,Me=(0,r.Z)(this.rotations);try{for(Me.s();!(xe=Me.n()).done;){var ze,De=xe.value,Ae=y[Re].rotateplane(De),Ee=!1,Ze=(0,r.Z)(this.moveplanes);try{for(Ze.s();!(ze=Ze.n()).done;){var Ue=ze.value;if(Ae.sameplane(Ue)){Ee=!0;break}}}catch(cn){Ze.e(cn)}finally{Ze.f()}Ee||(this.moveplanes.push(Ae),b[Re]&&this.moveplanes2.push(Ae))}}catch(cn){Me.e(cn)}finally{Me.f()}}for(var Ce=new ft(d),Oe=this.moveplanes2.slice(),Ie=31,Se=0;Se<Oe.length;Se++){var Pe=Se+Math.floor((Oe.length-Se)*(Ie/65536));Ce=Ce.split(Oe[Pe]),Oe[Pe]=Oe[Se],Ie=(1657*Ie+101)%65536}var Te=Ce.collect([],!0);this.faces=Te,this.options.verbosity>0&&console.log("# Faces is now ".concat(Te.length)),this.stickersperface=Te.length;var Ne,je=[],Ge=tt(d),qe=(0,r.Z)(this.rotations);try{for(qe.s();!(Ne=qe.n()).done;){var Ke=Ne.value,_e=Ke.rotateface(d);Ge.dist(tt(_e))<lt&&je.push(Ke)}}catch(cn){qe.e(cn)}finally{qe.f()}for(var He=new Array(Te.length),Je=[],Qe=0;Qe<Te.length;Qe++){var We=Te[Qe].centermass();Je.push([Ge.dist(We),We,Qe])}Je.sort((function(t,e){return t[0]-e[0]}));for(var Ve=0;Ve<Te.length;Ve++){var Xe=Je[Ve][2];if(!He[Xe]){He[Xe]=!0;var Ye,$e=(0,r.Z)(je);try{for($e.s();!(Ye=$e.n()).done;)for(var tn=Ye.value,en=Te[Xe].rotate(tn),nn=en.centermass(),rn=Ve+1;rn<Te.length&&!(Je[rn][0]-Je[Ve][0]>lt);rn++){var sn=Je[rn][2];if(!He[sn]&&nn.dist(Je[rn][1])<lt){He[sn]=!0,Te[sn]=en;break}}}catch(cn){$e.e(cn)}finally{$e.f()}}}this.shortedge=1e99;var an,on=(0,r.Z)(Te);try{for(on.s();!(an=on.n()).done;)for(var hn=an.value,fn=0;fn<hn.length;fn++){var ln=(fn+1)%hn.length,un=hn.get(fn).dist(hn.get(ln));un<this.shortedge&&(this.shortedge=un)}}catch(cn){on.e(cn)}finally{on.f()}this.options.verbosity>0&&console.log("# Short edge is ".concat(this.shortedge)),"c"!==e||!w||k||L||(this.addNotationMapper="NxNxNCubeMapper",this.setReidOrder=!0),"c"!==e||!L||w||k||(this.addNotationMapper="SkewbMapper"),"t"!==e||!L&&!w||k||(this.addNotationMapper="PyraminxOrTetraminxMapper"),"o"===e&&w&&(this.notationMapper=new v(this.swizzler,new l(["F","D","L","BL","R","U","BR","B"])),k||L||(this.addNotationMapper="FTOMapper")),"d"===e&&w&&(this.addNotationMapper="MegaminxMapper",this.notationMapper=new v(this.swizzler,new l(["U","F","L","BL","BR","R","FR","FL","DL","B","DR","D"])))}},{key:"keyface",value:function(t){return this.keyface2(t.centermass())}},{key:"keyface2",value:function(t){var e,n="",i=String.fromCharCode,s=(0,r.Z)(this.moveplanesets);try{for(s.s();!(e=s.n()).done;){var a=e.value;if(a.length>0){for(var o=t.dot(a[0]),h=0,f=1;2*f<=a.length;)f*=2;for(;f>0;f>>=1)h+f<=a.length&&o>a[h+f-1].a&&(h+=f);if(h<47)n+=i(33+h);else if(h<2256)n=n+i(80+Math.floor(h/47)-1)+i(33+h%47);else{if(!(h<106079))throw Error("Too many slices for cubie encoding");n=n+i(80+Math.floor((h-47)/2209-1))+i(80+Math.floor((h-47)/47)%47)+i(33+h%47)}}}}catch(l){s.e(l)}finally{s.f()}return n}},{key:"keyface3",value:function(t){var e,n=t.centermass(),i=[],s=(0,r.Z)(this.moveplanesets);try{for(s.s();!(e=s.n()).done;){var a=e.value;if(a.length>0){for(var o=n.dot(a[0]),h=0,f=1;2*f<=a.length;)f*=2;for(;f>0;f>>=1)h+f<=a.length&&o>a[h+f-1].a&&(h+=f);i.push(h)}}}catch(l){s.e(l)}finally{s.f()}return i}},{key:"findface",value:function(t){var e=this.keyface2(t),n=this.facelisthash.get(e);if(1===n.length)return n[0];for(var r=0;r+1<n.length;r++){var i=this.facelisthash.get(e)[r];if(Math.abs(t.dist(this.facecentermass[i]))<lt)return i}return n[n.length-1]}},{key:"project2d",value:function(t,e,n){var r=this.facenames[t][0],i=(e+1)%r.length,s=this.baseplanes[t],a=r[i].sub(r[e]),o=a.len(),h=(a=a.normalize()).cross(s).normalize(),f=n[1].sub(n[0]),l=f.len()/o,u=(f=f.normalize()).b,c=f.c,v=a.smul(u).sub(h.smul(c)).smul(l),m=h.smul(u).sum(a.smul(c)).smul(l),p=new nt(0,n[0].b-v.dot(r[e]),n[0].c-m.dot(r[e]),0);return[v,m,p]}},{key:"allstickers",value:function(){var t=this;this.faces=function(t,e){var n,i=[],s=(0,r.Z)(t);try{for(s.s();!(n=s.n()).done;){var a,o=n.value,h=(0,r.Z)(e);try{for(h.s();!(a=h.n()).done;){var f=a.value;i.push(f.rotate(o))}}catch(l){h.e(l)}finally{h.f()}}}catch(l){s.e(l)}finally{s.f()}return i}(this.baseplanerot,this.faces),this.options.verbosity>0&&console.log("# Total stickers is now ".concat(this.faces.length)),this.facecentermass=new Array(this.faces.length);for(var e=0;e<this.faces.length;e++)this.facecentermass[e]=this.faces[e].centermass();var n,i=[],s=[],a=(0,r.Z)(this.moveplanes);try{for(a.s();!(n=a.n()).done;){var o,h=n.value.makenormal(),f=!1,l=(0,r.Z)(s);try{for(l.s();!(o=l.n()).done;){var u=o.value;h.sameplane(u.makenormal())&&(f=!0)}}catch(Be){l.e(Be)}finally{l.f()}f||(s.push(h),i.push([]))}}catch(Be){a.e(Be)}finally{a.f()}var v,d=(0,r.Z)(this.moveplanes2);try{for(d.s();!(v=d.n()).done;)for(var g=v.value,y=g.makenormal(),b=0;b<s.length;b++)if(y.sameplane(s[b])){i[b].push(g);break}}catch(Be){d.e(Be)}finally{d.f()}for(var w=0;w<i.length;w++){for(var B=i[w].map((function(t){return t.normalizeplane()})),F=s[w],R=0;R<B.length;R++)B[R].makenormal().dist(F)>lt&&(B[R]=B[R].smul(-1));B.sort((function(t,e){return t.a-e.a})),i[w]=B}this.moveplanesets=i,this.moveplanenormals=s;var x=i.map((function(t){return t.length}));this.options.verbosity>0&&console.log("# Move plane sets: ".concat(x));for(var M=[],z=0;z<i.length;z++)M.push([]);var D,A=(0,r.Z)(this.rotations);try{for(A.s();!(D=A.n()).done;){var E=D.value;if(!(Math.abs(Math.abs(E.a)-1)<lt))for(var Z=E.makenormal(),C=0;C<i.length;C++)if(Z.sameplane(s[C])){M[C].push(E);break}}}catch(Be){A.e(Be)}finally{A.f()}this.moverotations=M;for(var O=0;O<M.length;O++){for(var I=M[O],S=I[0].makenormal(),P=0;P<I.length;P++)S.dist(I[P].makenormal())>lt&&(I[P]=I[P].smul(-1));I.sort((function(t,e){return t.angle()-e.angle()})),M[O][0].dot(s[O])<0&&I.reverse()}var T=M.map((function(t){return 1+t.length}));this.movesetorders=T;for(var N=[],j="?",G=0;G<i.length;G++){var q,K=s[G],_=null,H=null,J=(0,r.Z)(this.geonormals);try{for(J.s();!(q=J.n()).done;){var Q=q.value,W=K.dot(Q[0]);Math.abs(W-1)<lt?(H=[Q[1],Q[2]],j=Q[2]):Math.abs(W+1)<lt&&(_=[Q[1],Q[2]],j=Q[2])}}catch(Be){J.e(Be)}finally{J.f()}if(null===H||null===_)throw new Error("Saw positive or negative sides as null");N.push([H[0],H[1],_[0],_[1],1+i[G].length]),"NxNxNCubeMapper"===this.addNotationMapper&&"f"===j&&(this.notationMapper=new p(1+i[G].length),this.addNotationMapper=""),"SkewbMapper"===this.addNotationMapper&&1===i[0].length&&(this.notationMapper=new U(this.swizzler),this.addNotationMapper=""),"PyraminxOrTetraminxMapper"===this.addNotationMapper&&(2===i[0].length&&.333333333333333===i[0][0].a&&1.66666666666667===i[0][1].a?(this.notationMapper=new k(this.swizzler),this.addNotationMapper=""):(this.notationMapper=new L(this.swizzler),this.addNotationMapper="")),"MegaminxMapper"===this.addNotationMapper&&"f"===j&&(1+i[G].length===3&&(this.notationMapper=new m(this.notationMapper)),this.addNotationMapper=""),"FTOMapper"===this.addNotationMapper&&"f"===j&&(1+i[G].length===3&&(this.notationMapper=new c(this.notationMapper,this.swizzler)),this.addNotationMapper="")}this.movesetgeos=N;for(var V=new Map,X=this.faces,Y=0;Y<X.length;Y++){var $=X[Y],et=this.keyface($);if(V.get(et)){var nt=V.get(et);if(nt.push(Y),nt.length===this.baseFaceCount){this.options.verbosity>0&&console.log("# Splitting core.");for(var rt=0;rt<nt.length;rt++){var it="".concat(et," ").concat(rt);V.set(it,[nt[rt]])}}}else V.set(et,[Y])}this.facelisthash=V,this.options.verbosity>0&&console.log("# Cubies: ".concat(V.size));var st,at=[],ot=[],ht=[],ft=(0,r.Z)(V.values());try{for(ft.s();!(st=ft.n()).done;){var ut=st.value;if(ut.length!==this.baseFaceCount){if(ut.length>1){for(var ct=ut.map((function(t){return X[t].centermass()})),vt=tt(ct),mt=0;ut.length>2;mt++){for(var pt=!1,dt=0;dt<ut.length;dt++){var gt=(dt+1)%ut.length;if(vt.dot(ct[dt].cross(ct[gt]))<0){var yt=ct[dt];ct[dt]=ct[gt],ct[gt]=yt;var bt=ut[dt];ut[dt]=ut[gt],ut[gt]=bt,pt=!0}}if(!pt)break;if(mt>1e3)throw new Error("Bad epsilon math; too close to border")}var wt,kt=0,Lt=(0,r.Z)(ut);try{for(Lt.s();!(wt=Lt.n()).done;){var Bt=wt.value;kt|=1<<Math.floor(Bt/this.stickersperface)}}catch(Be){Lt.e(Be)}finally{Lt.f()}for(var Ft=this.markedface[kt],Rt=-1,xt=0;xt<ut.length;xt++)Math.floor(ut[xt]/this.stickersperface)===Ft&&(Rt=xt);if(Rt<0)throw new Error("Could not find marked face in list");if(0!==Rt)for(var Mt=ut.slice(),zt=0;zt<ut.length;zt++)ut[zt]=Mt[(Rt+zt)%ut.length]}for(var Dt=0;Dt<ut.length;Dt++){var At=ut[Dt];ot[At]=at.length,ht[At]=Dt}at.push(ut)}}}catch(Be){ft.e(Be)}finally{ft.f()}this.cubies=at,this.facetocubie=ot,this.facetoord=ht;for(var Et=["?","CENTERS","EDGES","CORNERS","C4RNER","C5RNER"],Zt=[],Ut=[0,0,0,0,0,0],Ct=[],Ot=[],It=0,St=[],Pt=[],Tt=[],Nt=[],jt=function(e){return at[e].map((function(e){return t.getfaceindex(e)})).join(" ")},Gt=[],qt=0;qt<at.length;qt++){var Kt=at[qt];if(0!==Kt.length&&!Ot[qt]){var _t={},Ht=0;Tt.push(0),Gt.push([]);var Jt=Kt.length,Qt=Ut[Jt]++,Wt=Et[Jt];void 0!==Wt&&Jt!==this.baseFaceCount||(Wt="CORE"),Wt+=0===Qt?"":Qt+1,Zt[It]=Wt,Ct[It]=Jt;var Vt=[qt],Xt=0;for(Ot[qt]=!0;Xt<Vt.length;){var Yt=Vt[Xt++],$t=jt(Yt);if((Kt.length>1||void 0===_t[$t])&&(_t[$t]=Ht++),Nt[Yt]=_t[$t],St[Yt]=It,Gt[It].push(Yt),Pt[Yt]=Tt[It]++,Vt.length<this.rotations.length){var te,ee=this.facecentermass[at[Yt][0]],ne=(0,r.Z)(M);try{for(ne.s();!(te=ne.n()).done;){var re=te.value,ie=this.facetocubie[this.findface(ee.rotatepoint(re[0]))];Ot[ie]||(Vt.push(ie),Ot[ie]=!0)}}catch(Be){ne.e(Be)}finally{ne.f()}}}It++}}if(this.setReidOrder&&4<=this.stickersperface&&this.stickersperface<=9){for(var se={},ae=0,oe=[["UF","UR","UB","UL","DF","DR","DB","DL","FR","FL","BR","BL"],["UFR","URB","UBL","ULF","DRF","DFL","DLB","DBR"],["U","L","F","R","B","D"]];ae<oe.length;ae++)for(var he=oe[ae],fe=0;fe<he.length;fe++){for(var le=0,ue=0;ue<he[fe].length;ue++)le|=1<<he[fe].charCodeAt(ue)-65;se[le]=fe}var ce,ve=(0,r.Z)(Gt);try{for(ve.s();!(ce=ve.n()).done;){var me,pe=ce.value,de=(0,r.Z)(pe);try{for(de.s();!(me=de.n()).done;){var ge,ye=me.value,be=0,we=(0,r.Z)(at[ye]);try{for(we.s();!(ge=we.n()).done;){var ke=ge.value;be|=1<<this.facenames[this.getfaceindex(ke)][1].charCodeAt(0)-65}}catch(Be){we.e(Be)}finally{we.f()}Pt[ye]=se[be]}}catch(Be){de.e(Be)}finally{de.f()}}}catch(Be){ve.e(Be)}finally{ve.f()}}if(this.cubiesetnums=St,this.cubieordnums=Pt,this.cubiesetnames=Zt,this.cubieords=Tt,this.orbitoris=Ct,this.cubievaluemap=Nt,this.cubiesetcubies=Gt,null!==this.options.fixedPieceType){for(var Le=0;Le<at.length;Le++)if("v"===this.options.fixedPieceType&&at[Le].length>2||"e"===this.options.fixedPieceType&&2===at[Le].length||"f"===this.options.fixedPieceType&&1===at[Le].length){this.fixedCubie=Le;break}if(this.fixedCubie<0)throw new Error("Could not find a cubie of type ".concat(this.options.fixedPieceType," to fix."))}this.options.verbosity>0&&console.log("# Cubie orbit sizes ".concat(Tt))}},{key:"unswizzle",value:function(t){var e=this.notationMapper.notationToInternal(t);return null===e?null:e.modified({family:this.swizzler.unswizzle(e.family)})}},{key:"stringToBlockMove",value:function(t){var e=RegExp("^(([0-9]+)-)?([0-9]+)?([^0-9]+)([0-9]+'?)?$"),n=t.match(e);if(null===n)throw new Error("Bad move passed ".concat(t));var r=n[4],i=void 0,s=void 0;if(void 0!==n[2]){if(void 0===n[3])throw new Error("Missing second number in range");i=parseInt(n[2],10)}void 0!==n[3]&&(s=parseInt(n[3],10));var a="1",o=1;return void 0!==n[5]&&("'"===(a=n[5])[0]&&(a="-".concat(a.substring(1))),o=parseInt(a,10)),new f.A6(new f.mv(r,s,i),o)}},{key:"parseMove",value:function(t){var e=this.notationMapper.notationToInternal(t);if(null===e)throw new Error("Bad move ".concat(t.family));var n,r=(t=e).family,i=!1;if(r.endsWith("v")&&r[0]<="Z"){if(void 0!==t.innerLayer||void 0!==t.outerLayer)throw new Error("Cannot use a prefix with full cube rotations");r=r.slice(0,-1),i=!0}r.endsWith("w")&&r[0]<="Z"&&(r=r.slice(0,-1).toLowerCase());for(var s=-1,a=this.swizzler.unswizzle(r),o=!1,h=0;h<this.movesetgeos.length;h++){var f=this.movesetgeos[h];a===f[0]&&(o=!0,n=f,s=h),a===f[2]&&(o=!1,n=f,s=h)}var l=1,u=1;if(r.toUpperCase()!==r&&(u=2),void 0===n)throw new Error("Bad grip in move ".concat(t.family));if(void 0!==t.outerLayer&&(l=t.outerLayer),void 0!==t.innerLayer&&(void 0===t.outerLayer?(u=t.innerLayer,l=r<="Z"?u:1):u=t.innerLayer),l--,u--,i&&(l=0,u=this.moveplanesets[s].length),l<0||l>this.moveplanesets[s].length||u<0||u>this.moveplanesets[s].length)throw new Error("Bad slice spec ".concat(l," ").concat(u," vs ").concat(this.moveplanesets[s].length));if(0===l&&u===this.moveplanesets[s].length&&!i)throw new Error("! full puzzle rotations must be specified with v suffix.");return[void 0,s,l,u,o,t.amount]}},{key:"parsemove",value:function(t){var e=this.parseMove(this.stringToBlockMove(t));return e[0]=t,e}},{key:"genperms",value:function(){if(!(this.cmovesbyslice.length>0)){var t=[];if(this.options.orientCenters)for(var e=0;e<this.cubies.length;e++)if(1===this.cubies[e].length){var n=this.cubies[e][0],i=this.getfaceindex(n),s=this.basefaces[i].centermass();if(s.dist(this.facecentermass[n])<lt){for(var a=1<<i|1<<this.baseFaceCount,o=this.markedface[a],h=this.baseplanes[o].makenormal(),f=-1,l=-1,u=0;u<this.faces[n].length;u++){var c=this.faces[n].get(u),v=h.dot(c.sub(s));v>f&&(f=v,l=u)}var m=(l+1)%this.faces[n].length;if(Math.abs(h.dot(this.faces[n].get(m).sub(s))-f)<lt&&(l=m),0!==l){for(var p=[],d=0;d<this.faces[n].length;d++)p.push(this.faces[n].get((d+l)%this.faces[n].length));this.faces[n]=new ht(p)}for(var g=this.basefaces[i].length,y=1;y<g;y++)this.cubies[e].push(this.cubies[e][y-1]);this.duplicatedFaces[n]=g,this.duplicatedCubies[e]=g,this.orbitoris[this.cubiesetnums[e]]=g}}for(var b=0;b<this.moveplanesets.length;b++){for(var w=this.moveplanesets[b],k=[],L=[w.length+1,0],B=1;2*B<=w.length;)B*=2;for(var F=0;F<this.faces.length;F++){var R=0;if(w.length>0){for(var x=this.facecentermass[F].dot(w[0]),M=B;M>0;M>>=1)R+M<=w.length&&x>w[R+M-1].a&&(R+=M);R=w.length-R}for(k.push(R);L.length<=R;)L.push(0);L[R]++}for(var z=new Array(L.length),D=0;D<L.length;D++)z[D]=[];for(var A=[],E=0;E<this.faces.length;E++)if(!(k[E]<0)){for(var Z=[this.facetocubie[E],this.facetoord[E]],U=this.facecentermass[E],C=U,O=E,I=k[O];;){k[O]=-1;var S=U.rotatepoint(this.moverotations[b][0]);if(S.dist(C)<lt)break;O=this.findface(S),Z.push(this.facetocubie[O],this.facetoord[O]),U=S}if(Z.length>2&&this.options.orientCenters&&(1===this.cubies[Z[0]].length||this.duplicatedCubies[Z[0]]>1)&&this.facecentermass[E].dist(this.basefaces[this.getfaceindex(E)].centermass())<lt)for(var P=this.faces[this.cubies[Z[0]][0]],T=0;T<Z.length;T+=2){for(var N=this.faces[this.cubies[Z[T]][0]],j=-1,G=0;G<P.length;G++)if(N.get(G).dist(P.get(0))<lt){j=G;break}if(j<0)throw new Error("Couldn't find rotation of center faces; ignoring for now.");Z[T+1]=j,P=P.rotate(this.moverotations[b][0])}if(2===Z.length&&this.options.orientCenters)for(var q=1;q<this.movesetorders[b];q++)0===I?Z.push(Z[0],q):Z.push(Z[0],(this.movesetorders[b]-q)%this.movesetorders[b]);if(Z.length>2&&!A[Z[0]]){if(Z.length!==2*this.movesetorders[b])throw new Error("Bad length in perm gen");var K,_=(0,r.Z)(Z);try{for(_.s();!(K=_.n()).done;){var H=K.value;z[I].push(H)}}catch($){_.e($)}finally{_.f()}}for(var J=0;J<Z.length;J+=2)A[Z[J]]=!0}for(var Q=0;Q<z.length;Q++)z[Q]=z[Q].slice();t.push(z)}if(this.cmovesbyslice=t,this.options.moveList){var W,V=[],X=(0,r.Z)(this.options.moveList);try{for(X.s();!(W=X.n()).done;){var Y=W.value;V.push(this.parsemove(Y))}}catch($){X.e($)}finally{X.f()}this.parsedmovelist=V}this.facelisthash.clear(),this.facecentermass=[]}}},{key:"getboundarygeometry",value:function(){return{baseplanes:this.baseplanes,facenames:this.facenames,faceplanes:this.faceplanes,vertexnames:this.vertexnames,edgenames:this.edgenames,geonormals:this.geonormals}}},{key:"getmovesets",value:function(t){var e=this.moveplanesets[t].length,n=[];if(void 0!==this.parsedmovelist){var i,s=(0,r.Z)(this.parsedmovelist);try{for(s.s();!(i=s.n()).done;){var a=i.value;a[1]===t&&(a[4]?n.push([a[2],a[3]]):n.push([e-a[3],e-a[2]]),n.push(a[5]))}}catch(d){s.e(d)}finally{s.f()}}else if(this.options.vertexMoves&&!this.options.allMoves){var o=this.movesetgeos[t];if(o[1]!==o[3])for(var h=0;h<e;h++)"v"!==o[1]?(this.options.outerBlockMoves?n.push([h+1,e]):n.push([h+1]),n.push(1)):(this.options.outerBlockMoves?n.push([0,h]):n.push([h,h]),n.push(1))}else for(var f=0;f<=e;f++)(this.options.allMoves||f+f!==e)&&(this.options.outerBlockMoves?f+f>e?n.push([f,e]):n.push([0,f]):n.push([f,f]),n.push(1));if(this.fixedCubie>=0){for(var l=this.keyface3(this.faces[this.cubies[this.fixedCubie][0]])[t],u=[],c=0;c<n.length;c+=2){var v=n[c];if(l>=v[0]&&l<=v[1])if(0===v[0])v=[v[1]+1,e];else{if(e!==v[1])throw Error("fixed cubie option would disconnect move");v=[0,v[0]-1]}for(var m=!1,p=0;p<u.length;p+=2)if(u[p][0]===v[0]&&u[p][1]===v[1]&&u[p+1]===n[c+1]){m=!0;break}m||(u.push(v),u.push(n[c+1]))}n=u}return n}},{key:"graybyori",value:function(t){var e=this.cubies[t].length;return this.duplicatedCubies[t]&&(e=1),1===e&&(this.options.grayCenters||!this.options.includeCenterOrbits)||2===e&&(this.options.grayEdges||!this.options.includeEdgeOrbits)||e>2&&(this.options.grayCorners||!this.options.includeCornerOrbits)}},{key:"skipbyori",value:function(t){var e=this.cubies[t].length;return this.duplicatedCubies[t]&&(e=1),1===e&&!this.options.includeCenterOrbits||2===e&&!this.options.includeEdgeOrbits||e>2&&!this.options.includeCornerOrbits}},{key:"skipcubie",value:function(t){return this.skipbyori(t)}},{key:"header",value:function(t){return t+"PuzzleGeometry 0.1 Copyright 2018 Tomas Rokicki.\n"+t+"\n"}},{key:"writegap",value:function(){for(var t=this.getOrbitsDef(!1),e=[],n=[],r=0;r<t.moveops.length;r++){var i="M_".concat(K(this.notationMapper,t.movenames[r])),s=!1;"'"===i[i.length-1]&&(i=i.substring(0,i.length-1),s=!0),n.push(i),s?e.push("".concat(i,":=").concat(t.moveops[r].toPerm().inv().toGap(),";")):e.push("".concat(i,":=").concat(t.moveops[r].toPerm().toGap(),";"))}e.push("Gen:=["),e.push(n.join(",")),e.push("];");var a=t.solved.identicalPieces();return e.push("ip:=[".concat(a.map((function(t){return"[".concat(t.map((function(t){return t+1})).join(","),"]")})).join(","),"];")),e.push("# Size(Group(Gen));"),e.push("# Size(Stabilizer(Group(Gen), ip, OnTuplesSets));"),e.push(""),this.header("# ")+e.join("\n")}},{key:"writeksolve",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"PuzzleGeometryPuzzle",e=this.getOrbitsDef(!1);return this.header("# ")+e.toKsolve(t,this.notationMapper).join("\n")}},{key:"getKPuzzleDefinition",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.getOrbitsDef(t,e),r=n.toKPuzzleDefinition(e);if(r.experimentalPuzzleDescription=this.puzzleDescription,!r)throw new Error("Missing definition!");return r}},{key:"getMoveFromBits",value:function(t,e,n,i,s,a){var o,h=[],f=[],l=[],u=(0,r.Z)(this.cubieords);try{for(u.s();!(o=u.n()).done;){var c=o.value;f.push(T(c)),l.push(P(c))}}catch(M){u.e(M)}finally{u.f()}for(var v=t[0];v<=t[1];v++)for(var m=i[v],p=0;p<m.length;p+=2*a){for(var d=m.slice(p,p+2*a),g=this.cubiesetnums[d[0]],y=0;y<d.length;y+=2)d[y]=this.cubieordnums[d[y]];var b=2,w=3;n&&(b=d.length-2,w=d.length-1),f[g]===T(this.cubieords[g])&&(f[g]=f[g].slice(),this.orbitoris[g]>1&&!this.options.fixedOrientation&&(l[g]=l[g].slice()));for(var k=0;k<d.length;k+=2)f[g][d[(k+b)%d.length]]=d[k],this.orbitoris[g]>1&&!this.options.fixedOrientation&&(l[g][d[k]]=(d[(k+w)%d.length]-d[(k+1)%d.length]+2*this.orbitoris[g])%this.orbitoris[g])}for(var L=new J(T(24),P(24),1),B=0;B<this.cubiesetnames.length;B++)if(!s||s[B])if(1===this.orbitoris[B]||this.options.fixedOrientation)f[B]===T(L.perm.length)?(f[B]!==L.perm&&(L=new J(f[B],l[B],1)),h.push(L)):h.push(new J(f[B],l[B],1));else{for(var F=new Array(l[B].length),R=0;R<f[B].length;R++)F[R]=l[B][f[B][R]];h.push(new J(f[B],F,this.orbitoris[B]))}var x=new W(h);return 1!==e&&(x=x.mulScalar(e)),x}},{key:"omitSet",value:function(t){var e,n=(0,r.Z)(this.options.excludeOrbits);try{for(n.s();!(e=n.n()).done;){if(e.value===t)return!0}}catch(i){n.e(i)}finally{n.f()}return!1}},{key:"diffmvsets",value:function(t,e,n,r){for(var i=0;i<t.length;i+=2){for(var s=!1,a=0;!s&&a<e.length;a+=2)r?t[i][0]+e[a][1]===n&&t[i][1]+e[a][0]===n&&t[i+1]===e[a+1]&&(s=!0):t[i][0]===e[a][0]&&t[i][1]===e[a][1]&&t[i+1]===e[a+1]&&(s=!0);if(!s)return!0}return!1}},{key:"getOrbitsDef",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=[];if(t)for(var i=0;i<this.cubiesetnames.length;i++)n.push(1);for(var s=[],a=[],o=[],h=[],f=0;f<this.moveplanesets.length;f++){var l=this.getmovesets(f);o.push(l),this.options.addRotations?h.push(1):h.push(0)}for(var u=[],c=0;c<this.moveplanesets.length;c++){for(var v=this.moveplanesets[c].length,m=!1,p=o[c],d=0;d<p.length;d+=2)0===p[d][0]&&p[d][1]===v&&(m=!0);u[c]=m}if(this.options.addRotations&&(this.options.moveList||null!==this.options.fixedPieceType)){for(var g=0;g<this.moverotations.length;g++)h[g]=0;for(var y=0;y<this.moveplanesets.length;y++)if(u[y])h[y]=3;else for(var b=0;b<this.moverotations.length;b++)for(var w=this.moveplanenormals[y],k=1;2*k<=this.movesetorders[b];k++)if(w=w.rotatepoint(this.moverotations[b][0]),!(h[b]&k)){for(var L=-1,B=!1,F=0;F<this.moveplanenormals.length;F++){if(w.dist(this.moveplanenormals[F])<lt){L=F;break}if(w.dist(this.moveplanenormals[F].smul(-1))<lt){L=F,B=!0;break}}if(L<0)throw new Error("Could not find rotation");var R=o[L];(R.length!==o[y].length||this.moveplanesets[y].length!==this.moveplanesets[L].length||this.diffmvsets(R,o[y],this.moveplanesets[L].length,B))&&(h[b]|=k)}for(var x=0;x<this.moverotations.length;x++)if(0===h[x])h[x]=1;else if(1===h[x])this.movesetorders[x]>3?h[x]=2:h[x]=0;else{if(3!==h[x])throw new Error("Impossible addrot val");h[x]=0}}for(var M=0;M<this.moveplanesets.length;M++)0===h[M]||u[M]||(o[M].push([0,this.moveplanesets[M].length]),o[M].push(h[M]));for(var z=0;z<this.moveplanesets.length;z++){for(var D=o[z],A=this.movesetorders[z],E=0;E<D.length;E+=2)for(var Z=0;Z<E;Z+=2)if(D[E][0]===D[Z][0]&&D[E][1]===D[Z][1])throw new Error("Redundant moves in moveset.");for(var U=[],C=0;C<D.length;C+=2)for(var O=D[C][0];O<=D[C][1];O++)U[O]=1;for(var I=this.cmovesbyslice[z],S=0;S<I.length;S++)if(1===U[S])for(var P=I[S],T=0;T<P.length;T+=2*A)if(!this.skipcubie(P[T])){var N=this.cubiesetnums[P[T]];n[N]=1}}for(var j=0;j<this.cubiesetnames.length;j++)n[j]&&(this.omitSet(this.cubiesetnames[j])?n[j]=0:(s.push(this.cubiesetnames[j]),a.push(new G(this.cubieords[j],this.options.fixedOrientation?1:this.orbitoris[j]))));for(var q=[],K=0;K<this.cubiesetnames.length;K++)if(n[K]&&!this.omitSet(this.cubiesetnames[K])){for(var H=[],Q=[],W=0;W<this.cubieords[K];W++){if(t)H.push(W);else{var X=this.cubiesetcubies[K][W];H.push(this.cubievaluemap[X])}Q.push(0)}q.push(new J(H,Q,this.options.fixedOrientation?1:this.orbitoris[K]))}var Y=[],$=[],tt=[],et=[];if(e)for(var nt=0;nt<this.moveplanesets.length;nt++)for(var rt=this.moveplanesets[nt],it=rt.length,st=o[nt],at=this.movesetgeos[nt],ot=0;ot<st.length;ot+=2){var ht=st[ot],ft=void 0,ut=!1;if(void 0!==this.parsedmovelist){var ct,vt=(0,r.Z)(this.parsedmovelist);try{for(vt.s();!(ct=vt.n()).done;){var mt=ct.value;if(mt[1]===nt){var pt=[];(pt=mt[4]?[mt[2],mt[3]]:[it-mt[3],it-mt[2]])[0]===ht[0]&&pt[1]===ht[1]&&(ft=mt[0],ut=!mt[4])}}}catch(kt){vt.e(kt)}finally{vt.f()}}if(ft)Y.push(ft),$.push(!0);else{var dt=wt(at,ht,it);ut=dt[1];var gt=dt[0];1===st[ot+1]?Y.push(gt):Y.push(gt+st[ot+1]),$.push(!1)}et.push(0===ht[0]&&ht[1]===it);var yt=this.getMoveFromBits(ht,st[ot+1],ut,this.cmovesbyslice[nt],n,this.movesetorders[nt]);tt.push(yt)}var bt=new _(s,a,new V(q),Y,tt,et,$);return this.options.optimizeOrbits&&(bt=bt.optimize()),0!==this.options.scrambleAmount&&bt.scramble(this.options.scrambleAmount),bt}},{key:"getScramble",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=this.getOrbitsDef(!1);return e.transformToKTransformationData(e.getScrambleTransformation(t))}},{key:"getMovesAsPerms",value:function(){return this.getOrbitsDef(!1).moveops.map((function(t){return t.toPerm()}))}},{key:"showcanon",value:function(t){!function(t,e){var n=t.moveops.length;if(n>30)throw new Error("Canon info too big for bitmask");for(var r=[],i=[],s=0;s<n;s++){var a=t.moveops[s];r.push(a.order());for(var o=0,h=0;h<n;h++)if(h!==s){var f=t.moveops[h];a.mul(f).equal(f.mul(a))&&(o|=1<<h)}i.push(o)}for(var l={0:1},u=0;u<100;u++){var c=0,v={},m=0;for(var p in l){var d=+p,g=l[d];c+=g,m++;for(var y=0;y<r.length;y++)if(0===(d>>y&1)&&0===(d&i[y]&(1<<y)-1)){var b=d&i[y]|1<<y;void 0===v[b]&&(v[b]=0),v[b]+=(r[y]-1)*g}}e("".concat(u,": canonseq ").concat(c," states ").concat(m)),l=v}}(this.getOrbitsDef(!1),t)}},{key:"getsolved",value:function(){for(var t=[],e=0;e<this.baseFaceCount;e++)for(var n=0;n<this.stickersperface;n++)t.push(e);return new j(t)}},{key:"getOrientationRotation",value:function(t){var e,n=(0,a.Z)(t[0],2),i=n[0],s=(0,a.Z)(n[1],3),o=s[0],h=s[1],f=s[2],l=new nt(0,o,-h,f),u=(0,a.Z)(t[1],2),c=u[0],v=(0,a.Z)(u[1],3),m=v[0],p=v[1],d=v[2],g=new nt(0,m,-p,d),y=null,b=null,w=this.swizzler.unswizzle(i),k=this.swizzler.unswizzle(c),L=(0,r.Z)(this.geonormals);try{for(L.s();!(e=L.n()).done;){var B=e.value;w===B[1]&&(y=B[0]),k===B[1]&&(b=B[0])}}catch(R){L.e(R)}finally{L.f()}if(!y)throw new Error("Could not find feature ".concat(i));if(!b)throw new Error("Could not find feature ".concat(c));var F=y.pointrotation(l);return b.rotatepoint(F).unproject(l).pointrotation(g.unproject(l)).mul(F)}},{key:"getInitial3DRotation",value:function(){var t=this.baseFaceCount,e=null;if(this.options.puzzleOrientation?e=this.options.puzzleOrientation:this.options.puzzleOrientations&&(e=this.options.puzzleOrientations[t]),e||(e={4:[["FLR",[0,1,0]],["F",[0,0,1]]],6:[["U",[0,1,0]],["F",[0,0,1]]],8:[["U",[0,1,0]],["F",[0,0,1]]],12:[["U",[0,1,0]],["F",[0,0,1]]],20:[["GUQMJ",[0,1,0]],["F",[0,0,1]]]}[t]),!e)throw new Error("No default orientation?");return this.getOrientationRotation(e)}},{key:"generate2dmapping",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:800,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.92;function o(t,e){for(var n=t[1][0]-t[0][0],r=t[1][1]-t[0][1],i=2*Math.PI/e,s=Math.cos(i),a=Math.sin(i),o=2;o<e;o++){var h=n*s+r*a;r=r*s-n*a,n=h,t.push([t[o-1][0]+n,t[o-1][1]+r])}}e-=2*i,n-=2*i,this.genperms();var h=this.getboundarygeometry(),f=h.facenames[0][0],l=f.length,u=this.net;if(null===u)throw new Error("No net?");var c={},v=0,m=0,p=1,d=0;c[u[0][0]]=[[1,0],[0,0]],o(c[u[0][0]],l);var g,y=(0,r.Z)(u);try{for(y.s();!(g=y.n()).done;){var b=g.value,w=b[0];if(!c[w])throw new Error("Bad edge description; first edge not connected.");for(var k=1;k<b.length;k++){var L=b[k];""===L||c[L]||(c[L]=[c[w][k%l],c[w][(k+l-1)%l]],o(c[L],l))}}}catch(dt){y.e(dt)}finally{y.f()}for(var B in c){var F,R=c[B],x=(0,r.Z)(R);try{for(x.s();!(F=x.n()).done;){var M=F.value;v=Math.min(v,M[0]),p=Math.max(p,M[0]),m=Math.min(m,M[1]),d=Math.max(d,M[1])}}catch(dt){x.e(dt)}finally{x.f()}}var z=Math.min(e/(p-v),n/(d-m)),D=.5*(e-z*(p+v)),A=.5*(n-z*(d+m)),E={},Z=this.getboundarygeometry(),U={},C=[[z+D,A],[D,A]];U[u[0][0]]=C,o(U[u[0][0]],l),E[this.facenames[0][1]]=this.project2d(0,0,[new nt(0,C[0][0],C[0][1],0),new nt(0,C[1][0],C[1][1],0)]);var O=[];O[0]=0;var I,S=(0,r.Z)(u);try{for(S.s();!(I=S.n()).done;){var P=I.value,T=P[0];if(!U[T])throw new Error("Bad edge description; first edge not connected.");for(var N=-1,j=0;j<Z.facenames.length;j++)if(T===Z.facenames[j][1]){N=j;break}if(N<0)throw new Error("Could not find first face name ".concat(T));for(var G=Z.facenames[N][0],q=1;q<P.length;q++){var K=P[q];if(""!==K&&!U[K]){U[K]=[U[T][q%l],U[T][(q+l-1)%l]],o(U[K],l);for(var _=O[N],H=G[(_+q)%l].sum(G[(_+q+l-1)%l]).smul(.5),J=ct(Z.edgenames,H),Q=Z.edgenames[J][1],W=kt(Q,this.facenames),V=W[T===W[0]?1:0],X=-1,Y=0;Y<Z.facenames.length;Y++)if(V===Z.facenames[Y][1]){X=Y;break}if(X<0)throw new Error("Could not find second face name");for(var $=Z.facenames[X][0],tt=0;tt<$.length;tt++){var et=$[tt].sum($[(tt+1)%l]).smul(.5);if(et.dist(H)<=lt){var rt=U[T][(q+l-1)%l],it=U[T][q%l];O[X]=tt,E[V]=this.project2d(X,tt,[new nt(0,it[0],it[1],0),new nt(0,rt[0],rt[1],0)]);break}}}}}}catch(dt){S.e(dt)}finally{S.f()}var st,at=0,ot=0,ht=this.getInitial3DRotation(),ft=(0,r.Z)(this.faces);try{for(ft.s();!(st=ft.n()).done;){var ut=st.value;s&&(ut=ut.rotate(ht));for(var vt=0;vt<ut.length;vt++)at=Math.max(at,Math.abs(ut.get(vt).b)),ot=Math.max(ot,Math.abs(ut.get(vt).c))}}catch(dt){ft.e(dt)}finally{ft.f()}var mt=Math.min(n/ot/2,(e-i)/at/4),pt=function(r,o){if(s){o=o.rotatepoint(ht);var h=.5*i+.25*e,f=t.baseplanes[r].rotateplane(ht).d<0?1:-1;return[i+.5*e+f*(h-o.b*mt),i+.5*n+o.c*mt]}var l=E[t.facenames[r][1]];return[i+a*o.dot(l[0])+l[2].b,i+n-a*o.dot(l[1])-l[2].c]};return pt}},{key:"generatesvg",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:800,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=this.generate2dmapping(t,e,n,r);function s(t,e,n){return'<polygon id="'.concat(t,'" class="sticker" style="fill: ').concat(n,'" points="').concat(e.map((function(t){return"".concat(t[0]," ").concat(t[1])})).join(" "),'"/>\n')}for(var a=this.getsolved(),o=[],h=[],f=0;f<this.baseFaceCount;f++)o[f]=this.colors[this.facenames[f][1]];for(var l=0;l<this.faces.length;l++){for(var u=this.faces[l],c=Math.floor(l/this.stickersperface),v=[],m=0;m<u.length;m++)v.push(i(c,u.get(m)));h.push(v)}for(var p=[],d=0;d<this.baseFaceCount;d++){p.push("<g>"),p.push("<title>".concat(this.facenames[d][1],"</title>\n"));for(var g=0;g<this.stickersperface;g++){var y=d*this.stickersperface+g,b=this.facetocubie[y],w=this.facetoord[y],k=this.cubiesetnums[b],L=this.cubieordnums[b],B=this.graybyori(b)?"#808080":o[a.p[y]],F="".concat(this.cubiesetnames[k],"-l").concat(L,"-o").concat(w);if(p.push(s(F,h[y],B)),this.duplicatedFaces[y])for(var R=1;R<this.duplicatedFaces[y];R++)F="".concat(this.cubiesetnames[k],"-l").concat(L,"-o").concat(R),p.push(s(F,h[y],B))}p.push("</g>")}var x='<svg id="svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 800 500">\n<style type="text/css"><![CDATA[.sticker { stroke: #000000; stroke-width: 1px; }]]></style>\n'.concat(p.join(""),"</svg>");return x}},{key:"get3d",value:function(t){for(var e=[],n=this.getInitial3DRotation(),i=[],s=.52*this.basefaces[0].get(0).len(),a=0;a<this.basefaces.length;a++){var o=this.basefaces[a].rotate(n),h=this.facenames[a][1];i.push({coords:Bt(o,s),name:h})}for(var l=0;l<this.faces.length;l++){var u=Math.floor(l/this.stickersperface),c=this.facetocubie[l],v=this.facetoord[l],m=this.cubiesetnums[c],p=this.cubieordnums[c],d=this.graybyori(c)?"#808080":this.colors[this.facenames[u][1]];null!==t&&void 0!==t&&t.stickerColors&&(d=t.stickerColors[l]);var g=this.faces[l].rotate(n);e.push({coords:Bt(g,s),color:d,orbit:this.cubiesetnames[m],ord:p,ori:v,face:u});var y=g;if(this.duplicatedFaces[l])for(var b=y.length/this.duplicatedFaces[l],w=1;w<this.duplicatedFaces[l];w++){for(var k=0;k<b;k++)y=y.rotateforward();e.push({coords:Bt(y,s),color:d,orbit:this.cubiesetnames[m],ord:p,ori:w,face:u,isDup:!0})}}for(var L=[],B=0;B<this.movesetgeos.length;B++){var F,R=this.movesetgeos[B],x=this.movesetorders[B],M=(0,r.Z)(this.geonormals);try{for(M.s();!(F=M.n()).done;){var z=F.value;R[0]===z[1]&&R[1]===z[2]&&(L.push({coordinates:Lt(z[0].rotatepoint(n),1),quantumMove:new f.A6(R[0]),order:x}),L.push({coordinates:Lt(z[0].rotatepoint(n).smul(-1),1),quantumMove:new f.A6(R[2]),order:x}))}}catch(E){M.e(E)}finally{M.f()}}var D=this.generate2dmapping(2880,2160,0,!1,1),A=function(){var t=n.invrot();return function(e,n){var r=new nt(0,n[0]*s,-n[1]*s,n[2]*s);r=r.rotatepoint(t);var i=D(e,r);return i[0]/=2880,i[1]=1-i[1]/2160,i}}().bind(this);return{stickers:e,faces:i,axis:L,unswizzle:this.unswizzle.bind(this),notationMapper:this.notationMapper,textureMapper:{getuv:A}}}},{key:"getGeoNormal",value:function(t){var e,n=this.getInitial3DRotation(),i=this.swizzler.unswizzle(t),s=(0,r.Z)(this.geonormals);try{for(s.s();!(e=s.n()).done;){var a=e.value;if(i===a[1]){var o=Lt(a[0].rotatepoint(n),1);return Math.abs(o[0])<lt&&Math.abs(o[2])<lt&&(o[0]=0,o[2]=1e-6),o}}}catch(h){s.e(h)}finally{s.f()}}},{key:"getfaceindex",value:function(t){var e=this.stickersperface;return Math.floor(t/e)}},{key:"textForTwizzleExplorer",value:function(){return"Faces ".concat(this.baseplanerot.length,"\nStickers per face ").concat(this.stickersperface,"\nShort edge ").concat(this.shortedge,"\nCubies ").concat(this.cubies.length,"\nEdge distance ").concat(this.edgedistance,"\nVertex distance ").concat(this.vertexdistance)}},{key:"writeSchreierSims",value:function(t){var e=this.getOrbitsDef(!1).reassemblySize();t("Reassembly size is ".concat(e));var n=ot(this.getMovesAsPerms(),t);t("Ratio is ".concat(e/n))}}]),t}(),Rt=function(){function t(e,n){(0,o.Z)(this,t),this.pg=e,this.orbitNames=n.orbitnames}return(0,h.Z)(t,[{key:"lookupMove",value:function(t){var e=this.pg.parseMove(t);if(this.pg.parsedmovelist){var n,i=!1,s=(0,r.Z)(this.pg.parsedmovelist);try{for(s.s();!(n=s.n()).done;){var a=n.value;a[1]===e[1]&&a[2]===e[2]&&a[3]===e[3]&&a[4]===e[4]&&(i=!0)}}catch(l){s.e(l)}finally{s.f()}if(!i)return null}var o=[e[2],e[3]];if(!e[4]){var h=this.pg.moveplanesets[e[1]].length;o=[h-e[3],h-e[2]]}var f=this.pg.getMoveFromBits(o,e[5],!e[4],this.pg.cmovesbyslice[e[1]],void 0,this.pg.movesetorders[e[1]]);return _.transformToKTransformationData(this.orbitNames,f)}}]),t}()}}]);